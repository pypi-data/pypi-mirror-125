(self.webpackChunkttgtcanvas2=self.webpackChunkttgtcanvas2||[]).push([[367],{8451:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.RobotModel=e.orientation_hash=void 0;const a=i(s(8995)),n=(t,e)=>(t%e+e)%e,r=[[0,1],[-1,0],[0,-1],[1,0]];e.orientation_hash={EAST:0,NORTH:1,WEST:2,SOUTH:3};const o=[{x:10,y:10},{x:10,y:40},{x:40,y:40},{x:40,y:10}];e.RobotModel=class{constructor(t,e,s,i,r,o){this.points=[],this.traceColor="red",this.speed=1,this.move_to=(t,e)=>new Promise((s=>{let[i,n]=this.cr2xy(t,e);new a.default.Tween({node:this.node,x:i,y:n,duration:this.speed,onFinish:()=>{this.x=t,this.y=e,console.log("finished",t,e),this.add_point(t,e),s("done")}}).play()})),this.turn_left=()=>new Promise((t=>{this.orientation=n(this.orientation+1,4);let[e,s]=this.cr2xy(this.x,this.y);new a.default.Tween({node:this.node,rotation:n(-90*this.orientation,360),duration:this.speed,x:e,y:s,onFinish:()=>{this.node.rotation(n(-90*this.orientation,360)),this.add_point(this.x,this.y),console.log("finished",this.x,this.y),t("done")}}).play()})),this.index=t,this.x=s,this.y=i,this.orientation=r,this.image=o,this.world=e,this.canvas=this.world.ui.layers.main,this.speed=.1,this.bs=this.world.bs}cr2xy(t,e){let[s,i]=this.world.point2cxy(t,e),a=o[this.orientation];return[s+50+a.x,i-25+a.y]}trace_point(t,e){let[s,i]=this.cr2xy(t,e),[a,l]=r[n(this.orientation-1,4)];console.log(a,l);let[d,h]=r[n(this.orientation-2,4)],u=o[this.orientation];return[s+5*(a+d)-u.x,i-5*(l+h)-u.y]}draw_trace(){let t=new a.default.Line({points:this.points.slice(Math.max(this.points.length-4,0)),stroke:this.traceColor,x:this.bs/2,y:this.bs/2});this.world.ui.layers.line.add(t),this.world.ui.layers.line.draw()}add_point(t,e){const[s,i]=this.trace_point(t,e);this.points=this.points.concat([s,i]),this.draw_trace()}set_trace(t){this.traceColor=t,this.add_point(this.x,this.y)}set_speed(t){this.speed=t}clear_trace(){this.points=[],this.world.ui.layers.line.destroyChildren(),this.world.ui.layers.line.draw()}draw(){let[t,e]=this.cr2xy(this.x,this.y);if(this.image)a.default.Image.fromURL(this.image,(s=>{s.setAttrs({x:t,y:e,width:this.bs-15,height:this.bs-15,rotation:-90*this.orientation}),this.node=s,this.canvas.add(this.node),this.canvas.batchDraw()}));else{var s="data:image/svg+xml;base64,"+btoa('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" class="svg-triangle" width=\'100\' height=\'100\' fill="#008080">\n<path d="M 95,50 5,95 5,5 z"/>\n</svg>');a.default.Image.fromURL(s,(s=>{s.setAttrs({x:t,y:e,width:this.bs-15,height:this.bs-15,rotation:-90*this.orientation}),this.node=s,this.canvas.add(this.node),this.canvas.batchDraw()}))}}}},9367:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.WorldModel=void 0;const a=i(s(8995)),n=s(8451),r=i(s(9755)),o=i(s(1763)),l=i(s(3608)),d=i(s(2475)),h={normal:{x:50,y:25,stroke:"darkred",strokeWidth:10},removable:{x:50,y:25,stroke:"#de1738",strokeWidth:10},goal:{x:50,y:25,stroke:"darkred",strokeWidth:7,dash:[5,5]}};e.WorldModel=class{constructor(){this.init_ui()}init(t,e,s=[],i=[],a=[],r={},o={},l=[],d=[],h=[]){this.rows=Math.min(20,t),this.cols=Math.min(20,e),this.vwalls=s,this.hwalls=i,this.bs=Math.ceil(Math.min(450/this.rows,600/this.cols,50)),this.height=t*this.bs,this.width=e*this.bs,this.objects=r,this.tileMap=o,this.tiles=l,this.pending_goals=d,this.drop_goals=h,this.draw_canvas(),this.robots=a.map(((t,e)=>new n.RobotModel(e,this,t.x,t.y,t.orientation,t.image))),console.log(a),this.robots[0].draw()}init_ui(){let t=document.createElement("div");t.setAttribute("class","ttgt-wrapper");let e=document.createElement("div");e.setAttribute("id","container");let s=document.createElement("span"),i=document.createTextNode("Toggle");s.appendChild(i),s.setAttribute("class","bttn-txt");let n=document.createElement("button");n.appendChild(s),n.setAttribute("class","ttgt-sidebar-bttn"),n.onclick=function(){r.default("#container").toggle()},t.appendChild(e),t.appendChild(n),this.ui={wrapper:t,layers:{bg:new a.default.Layer({offsetY:-150}),main:new a.default.Layer({offsetY:-150}),line:new a.default.Layer({offsetY:-150})}}}draw_canvas(){let t=new a.default.Stage({container:"container",width:Math.max(this.width,500)+this.bs+25,height:this.height+this.bs+25+150});this.ui.layers.msg=new a.default.Layer({width:500+this.bs+25,height:150}),t.add(this.ui.layers.msg),t.add(this.ui.layers.bg),t.add(this.ui.layers.main),t.add(this.ui.layers.line),this.ui.stage=t,this.draw_border(),this.draw_grid(),this.draw_objects(),this.draw_stats(),this.draw_msg_containers(),this.draw_drop_goals(this.drop_goals),this.pending_goals.length>0?this.draw_pending_instructions(this.pending_goals,"red"):this.draw_pending_instructions(this.pending_goals),this.ui.layers.main.draw()}draw_msg_containers(){var t,e;let s=new a.default.Text({y:60,width:550,align:"center",verticalAlign:"center",height:15,fontSize:20,text:"Pending Tasks"});null===(t=this.ui.layers.msg)||void 0===t||t.add(s),null===(e=this.ui.layers.msg)||void 0===e||e.draw()}draw_updated_stats(){var t,e;(null===(t=this.ui.layers.msg)||void 0===t?void 0:t.find(".stats_table")[0])&&[this.stats.total_moves,this.stats.current_load,this.stats.max_capacity||"Unlimited"].map(((t,e)=>{var s;let i=null===(s=this.ui.layers.msg)||void 0===s?void 0:s.find(`.stats-table-val-${e}`)[0];i&&i.text(`${t}`)})),null===(e=this.ui.layers.msg)||void 0===e||e.draw()}draw_stats(){let t=this.ui.layers.msg,e=new a.default.Group({x:40,y:5}),s=new a.default.Rect({width:500,height:40,stroke:"gray",strokeWidth:1,name:"stats_table"});e.add(s);for(let t=1;t<3;t++){let i=s.x()+Math.abs(s.width()/3)*t,n=s.y(),r=new a.default.Line({points:[i,n,i,s.height()],strokeWidth:1,stroke:"gray"});e.add(r)}let i=new a.default.Line({points:[s.x(),s.height()/2,s.width()+s.x(),s.height()/2],strokeWidth:1,stroke:"gray"});e.add(i);let n=[this.stats.total_moves,this.stats.current_load,this.stats.max_capacity||"Unlimited"],r=s.width()/3,o=s.x();["TOTAL MOVES","CURRENT LOAD","MAX CAPACITY"].map(((t,i)=>{let l=new a.default.Text({padding:5,x:Math.abs(r)*i+o,text:t,strokeWidth:5}),d=new a.default.Text({padding:5,x:Math.abs(r)*i+o,y:Math.abs(s.height()/2),text:`${n[i]}`,strokeWidth:10,fontSize:16,name:`stats-table-val-${i}`});e.add(l,d)})),null==t||t.add(e),null==t||t.draw()}draw_pending_instructions(t=["No Goal"],e="black",s=16){var i;let n=this.ui.layers.msg,r=null===(i=this.ui.layers.msg)||void 0===i?void 0:i.find(".instruction_msg")[0];r&&r.destroy();let o=t.slice(0,3).join("\n"),l=Math.max((null==n?void 0:n.width())||0,200)-70,d=new a.default.Text({padding:10,text:o,x:40,y:90,align:"left",fill:e,lineHeight:1.2,fontSize:s,width:l,name:"instruction_msg-rect"}),h=new a.default.Rect({width:l,height:d.height(),cornerRadius:10,stroke:"black",x:40,y:90,name:"instruction_msg"});null==n||n.add(h),null==n||n.add(d),null==n||n.draw()}success_msg(t){var e,s;let i=null===(e=this.ui.layers.msg)||void 0===e?void 0:e.find(".instruction_msg")[0],a=null===(s=this.ui.layers.msg)||void 0===s?void 0:s.find(".instruction_msg-rect")[0];return i&&(i.destroy(),null==a||a.destroy()),this.draw_pending_instructions([].concat(t),"green",20)}draw_objects(){for(const t in this.objects){const[e,s]=t.split(",").map((t=>parseInt(t)));this.draw_object(e,s,this.objects[t])}}draw_object(t,e,s){for(const i in s){let a=this.parse_value(s[i]);"beeper"===i?this.draw_beeper(t,e,a):this.draw_custom(i,t,e,a)}}update_object(t,e,s){let i=this.ui.layers.main.find(`.obj-${t}-${e}-text`)[0];i&&(i.text(`${s}`),this.ui.layers.main.draw())}draw_beeper(t,e,s){let i=.6*this.bs/2,[n,r]=this.point2cxy(t+1,e);n+=this.bs/2;let o=new a.default.Circle({radius:i,x:n,y:r,fill:"yellow",stroke:"orange",strokeWidth:5,name:`obj-${t}-${e}-circle`}),l=new a.default.Text({text:`${s}`,x:n-5,y:r-7,fontSize:18,name:`obj-${t}-${e}-text`});this.ui.layers.main.add(o,l)}remove_object(t,e){let s=this.ui.layers.main.find(`.obj-${t}-${e}-circle`)[0],i=this.ui.layers.main.find(`.obj-${t}-${e}-text`)[0],a=this.ui.layers.main.find(`.obj-${t}-${e}-img`)[0];s&&s.destroy(),i&&i.destroy(),a&&a.destroy(),this.ui.layers.main.draw()}draw_custom(t,e,s,i,n=!1){let r=this.tileMap[t],[o,l]=this.point2cxy(e,s),d=.4*this.bs/2,h=new a.default.Group({x:o+50+(this.bs-d)-2,y:l-this.bs/2+(this.bs-d)-2});if(!n){let t=new a.default.Circle({radius:d,fill:"white",stroke:"#aaa",opacity:.9}),n=i>9?2:4,r=Math.ceil(14*this.bs/50),o=new a.default.Text({text:`${i}`,fontSize:r,name:`obj-${e}-${s}-text`,offsetX:t.x()+d-n,offsetY:t.y()+d-n});h.add(t,o)}a.default.Image.fromURL(r,(t=>{t.setAttrs({x:o+50,y:l-this.bs/2,width:this.bs,height:this.bs,name:`obj-${e}-${s}-img`}),n?(t.cache(),t.filters([a.default.Filters.Grayscale]),this.ui.layers.main.add(t)):(this.ui.layers.main.add(t),this.ui.layers.main.add(h)),this.ui.layers.main.batchDraw()}))}draw_drop_goals(t=[]){t.map((t=>{this.draw_custom(t.obj_name,t.x,t.y,t.val,!0)}))}update_stats(t={}){this.stats=t,this.draw_updated_stats()}parse_value(t){if(!t)return 0;if(o.default(t))return t;{const[e,s]=t.split("-").map((t=>parseInt(t)));return l.default(e,s)}}draw_border(){let t=new a.default.Rect({x:50,y:this.bs/2,stroke:"darkred",strokeWidth:10,closed:!0,width:this.width,height:this.height});this.ui.layers.main.add(t)}draw_grid(){this.draw_cols(),this.draw_rows(),this.draw_walls(),this.draw_tiles()}_draw_tile(t,e,s){let[i,n]=this.point2cxy(t,e),r=this.tileMap[s];a.default.Image.fromURL(r,(s=>{s.setAttrs({x:i+50,y:n-this.bs/2,width:this.bs,height:this.bs,name:`obj-${t}-${e}-tilebg`}),this.ui.layers.bg.add(s),this.ui.layers.bg.batchDraw()}))}draw_tiles(){this.tiles.forEach(((t,e)=>{t.forEach(((t,s)=>{t&&this._draw_tile(e+1,s+1,t)}))}))}draw_cols(){for(let t=1;t<this.cols;t++){let e=new a.default.Line({x:50,y:this.bs/2,stroke:"gray",points:[t*this.bs,5,t*this.bs,this.height-5]}),s=new a.default.Text({text:`${t}`,y:this.height+40,x:t*this.bs+25});this.ui.layers.main.add(e,s)}let t=new a.default.Text({text:`${this.cols}`,y:this.height+40,x:this.cols*this.bs+25});this.ui.layers.main.add(t)}draw_rows(){for(let t=1;t<this.rows;t++){let e=new a.default.Line({x:50,y:this.bs/2,stroke:"gray",points:[this.width-5,t*this.bs,5,t*this.bs]}),s=new a.default.Text({text:""+(this.rows+1-t),x:this.bs/2,y:t*this.bs-10});this.ui.layers.main.add(e,s)}let t=new a.default.Text({text:"1",x:25,y:this.rows*this.bs-10});this.ui.layers.main.add(t)}point2cxy(t,e){return[(t-1)*this.bs,this.height-(e-1)*this.bs]}draw_wall(t,e,s,i="normal"){let n=h[i],r=null,[o,l]=this.point2cxy(t,e);"east"===s&&(r=new a.default.Line(Object.assign(Object.assign({},n),{name:`vwall-${t}-${e}`,points:[o+this.bs,l-this.bs,o+this.bs,l]}))),"north"===s&&(r=new a.default.Line(Object.assign(Object.assign({name:`hwall-${t}-${e}`},n),{points:[o,l-this.bs,o+this.bs,l-this.bs]}))),r&&this.ui.layers.main.add(r)}remove_wall(t,e,s){if("north"!==s&&"east"!==s)return;let i=this.ui.layers.main.find(`.${"north"===s?"hwall":"vwall"}-${t}-${e}`)[0];i&&i.destroy(),this.ui.layers.main.draw()}draw_typed_wall(t,e,s,i){let[a,n,r]=d.default(Number(i).toString(2),3,"0");parseInt(r)?parseInt(n)?this.draw_wall(t,e,s,"removable"):this.draw_wall(t,e,s,"normal"):parseInt(a)&&this.draw_wall(t,e,s,"goal")}draw_walls(){this.hwalls.forEach(((t,e)=>{t.forEach(((t,s)=>{t?this.draw_typed_wall(e,s,"north",t):this.remove_wall(e,s,"north")}))})),this.vwalls.forEach(((t,e)=>{t.forEach(((t,s)=>{t?this.draw_typed_wall(e,s,"east",t):this.remove_wall(e,s,"east")}))}))}}},8657:(t,e,s)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MODULE_NAME=e.MODULE_VERSION=void 0;const i=s(306);e.MODULE_VERSION=i.version,e.MODULE_NAME=i.name},1367:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.MazeView=e.MazeModel=void 0;const a=s(2565),n=s(8657);s(7204);const r=s(9367),o=new(i(s(9269)).default)({concurrency:1});class l extends a.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:l.model_name,_model_module:l.model_module,_model_module_version:l.model_module_version,_view_name:l.view_name,_view_module:l.view_module,_view_module_version:l.view_module_version,current_call:"{}",method_return:"{}"})}}e.MazeModel=l,l.serializers=Object.assign({},a.DOMWidgetModel.serializers),l.model_name="MazeModel",l.model_module=n.MODULE_NAME,l.model_module_version=n.MODULE_VERSION,l.view_name="MazeView",l.view_module=n.MODULE_NAME,l.view_module_version=n.MODULE_VERSION;class d extends a.DOMWidgetView{constructor(){super(...arguments),this.method_changed=()=>{let t=JSON.parse(this.model.get("current_call"));if(this.report_stats(t.stats),"halt"===t.method_name)return this.halt();o.add((()=>new Promise((e=>{let s="function"==typeof this[t.method_name]?this[t.method_name].apply(this,t.params):null;console.log("current_call in promise -> new code",t);let i=this;Promise.resolve(s).then((function(e){let s=JSON.stringify({value:e,cb:+new Date,params:t.params,method:t.method_name});return console.log("setting return",s),i.model.set("method_return",s),i.model.save_changes(),s})).then(e)}))))},this.draw_all=(t,e,s,i,a=[],n={},r={},o=[],l=[],d=[])=>this.world_model.init(t,e,s,i,a,n,r,o,l,d),this.halt=()=>o.clear(),this.move_to=(t,e,s)=>{var i;return null===(i=this.world_model.robots[t])||void 0===i?void 0:i.move_to(e,s)},this.report_stats=t=>this.world_model&&this.world_model.update_stats&&this.world_model.update_stats(t),this.turn_left=t=>{var e;return null===(e=this.world_model.robots[t])||void 0===e?void 0:e.turn_left()},this.set_trace=(t,e)=>{var s;return null===(s=this.world_model.robots[t])||void 0===s?void 0:s.set_trace(e)},this.set_speed=(t,e)=>{var s;return null===(s=this.world_model.robots[t])||void 0===s?void 0:s.set_speed(e)},this.add_wall=(t,e,s)=>this.world_model.draw_wall(t,e,s),this.add_object=(t,e,s,i)=>this.world_model.draw_object(t,e,{[s]:i}),this.add_goal_object=(t,e,s,i)=>this.world_model.draw_custom(s,t,e,i,!0),this.update_object=(t,e,s)=>this.world_model.update_object(t,e,s),this.remove_object=(t,e)=>this.world_model.remove_object(t,e),this.remove_wall=(t,e,s)=>this.world_model.remove_wall(t,e,s),this.set_succes_msg=t=>this.world_model.success_msg(t)}render(){this.method_changed(),this.listenTo(this.model,"change:current_call",this.method_changed),this.world_model||(this.world_model=new r.WorldModel,this.el.appendChild(this.world_model.ui.wrapper))}}e.MazeView=d},3889:(t,e,s)=>{(e=s(3645)(!1)).push([t.id,"#container {\n  position: fixed;\n  right: 40px;\n  bottom: 0;\n  min-width: 550px;\n  background-color: #fff;\n  border-left: 1px solid #aaa;\n  border-top: 1px solid #aaa;\n  z-index: 105;\n}\n\n.bttn-txt {\n  -webkit-transform: rotate(90deg);\n  -moz-transform: rotate(90deg);\n  -ms-transform: rotate(90deg);\n  -o-transform: rotate(90deg);\n  transform: rotate(90deg);\n  width: 100%;\n  display: inline-block;\n}\n\n.ttgt-sidebar-bttn {\n  position: fixed;\n  right: 0;\n  bottom: 0;\n  width: 40px;\n  background-color: #f8f5e1;\n\n  z-index: 105;\n  height: 500px;\n}\n\n.ttgt-wrapper {\n  position: absolute;\n  right: 0;\n  bottom: 0;\n  background-color: #fff;\n  border-left: 1px solid #aaa;\n  border-top: 1px solid #aaa;\n  z-index: 105;\n}\n\n.hide {\n  display: none;\n}\n\n.show {\n  display: inherit;\n}\n",""]),t.exports=e},7204:(t,e,s)=>{var i=s(3379),a=s(3889);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[t.id,a,""]]);i(a,{insert:"head",singleton:!1}),t.exports=a.locals||{}},306:t=>{"use strict";t.exports=JSON.parse('{"name":"ttgtcanvas2","version":"0.1.26","description":"A maze library","keywords":["jupyter","jupyterlab","jupyterlab-extension","widgets"],"files":["lib/**/*.js","dist/*.js","css/*.css"],"homepage":"https://github.com//ttgtcanvas2","bugs":{"url":"https://github.com//ttgtcanvas2/issues"},"license":"BSD-3-Clause","author":{"name":"Indresh Vishwakarma","email":"indresh@varsito.com"},"main":"lib/index.js","types":"./lib/index.d.ts","repository":{"type":"git","url":"https://github.com//ttgtcanvas2"},"scripts":{"build":"yarn run build:lib && yarn run build:nbextension && yarn run build:labextension:dev","build:prod":"yarn run build:lib && yarn run build:nbextension && yarn run build:labextension","build:labextension":"jupyter labextension build .","build:labextension:dev":"jupyter labextension build --development True .","build:lib":"tsc","build:nbextension":"webpack","clean":"yarn run clean:lib && yarn run clean:nbextension && yarn run clean:labextension","clean:lib":"rimraf lib","clean:labextension":"rimraf ttgtcanvas2/labextension","clean:nbextension":"rimraf ttgtcanvas2/nbextension/static/index.js","lint":"eslint . --ext .ts,.tsx --fix","lint:check":"eslint . --ext .ts,.tsx","prepack":"yarn run build:lib","test":"jest","watch":"npm-run-all -p watch:*","watch:lib":"tsc -w","watch:nbextension":"webpack --watch --mode=development","watch:labextension":"jupyter labextension watch ."},"dependencies":{"@jupyter-widgets/base":"^1.1.10 || ^2.0.0 || ^3.0.0 || ^4.0.0","konva":"^8.0.2","lodash":"^4.17.21","p-queue":"^7.1.0"},"devDependencies":{"@babel/core":"^7.5.0","@babel/preset-env":"^7.5.0","@jupyterlab/builder":"^3.0.0","@phosphor/application":"^1.6.0","@phosphor/widgets":"^1.6.0","@types/jest":"^26.0.0","@types/webpack-env":"^1.13.6","@typescript-eslint/eslint-plugin":"^3.6.0","@typescript-eslint/parser":"^3.6.0","acorn":"^7.2.0","css-loader":"^3.2.0","eslint":"^7.4.0","eslint-config-prettier":"^6.11.0","eslint-plugin-prettier":"^3.1.4","fs-extra":"^7.0.0","identity-obj-proxy":"^3.0.0","jest":"^26.0.0","mkdirp":"^0.5.1","npm-run-all":"^4.1.3","prettier":"^2.0.5","rimraf":"^2.6.2","source-map-loader":"^1.1.3","style-loader":"^1.0.0","ts-jest":"^26.0.0","ts-loader":"^8.0.0","typescript":"~4.1.3","webpack":"^5.0.0","webpack-cli":"^4.0.0"},"jupyterlab":{"extension":"lib/plugin","outputDir":"ttgtcanvas2/labextension/","sharedPackages":{"@jupyter-widgets/base":{"bundled":false,"singleton":true}}}}')}}]);