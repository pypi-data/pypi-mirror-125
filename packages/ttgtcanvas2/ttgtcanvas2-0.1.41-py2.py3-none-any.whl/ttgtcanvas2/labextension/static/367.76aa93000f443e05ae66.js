(self.webpackChunkttgtcanvas2=self.webpackChunkttgtcanvas2||[]).push([[367],{8451:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.RobotModel=e.orientation_hash=void 0;const n=s(i(8995)),a=(t,e)=>(t%e+e)%e,r=[[0,1],[-1,0],[0,-1],[1,0]];e.orientation_hash={EAST:0,NORTH:1,WEST:2,SOUTH:3};const o=[{x:10,y:10},{x:10,y:40},{x:40,y:40},{x:40,y:10}];e.RobotModel=class{constructor(t,e,i,s,r,o){this.points=[],this.traceColor="red",this.speed=1,this.move_to=(t,e)=>new Promise((i=>{let[s,a]=this.cr2xy(t,e);new n.default.Tween({node:this.node,x:s,y:a,duration:this.speed,onFinish:()=>{this.x=t,this.y=e,console.log("finished",t,e),this.add_point(t,e),i("done")}}).play()})),this.turn_left=()=>new Promise((t=>{this.orientation=a(this.orientation+1,4);let[e,i]=this.cr2xy(this.x,this.y);new n.default.Tween({node:this.node,rotation:a(-90*this.orientation,360),duration:this.speed,x:e,y:i,onFinish:()=>{this.node.rotation(a(-90*this.orientation,360)),this.add_point(this.x,this.y),console.log("finished",this.x,this.y),t("done")}}).play()})),this.index=t,this.x=i,this.y=s,this.orientation=r,this.image=o,this.world=e,this.canvas=this.world.ui.layers.main,this.speed=.1,this.bs=this.world.bs}cr2xy(t,e){let[i,s]=this.world.point2cxy(t,e),n=o[this.orientation];return[i+50+n.x,s-25+n.y]}trace_point(t,e){let[i,s]=this.cr2xy(t,e),[n,l]=r[a(this.orientation-1,4)];console.log(n,l);let[d,h]=r[a(this.orientation-2,4)],u=o[this.orientation];return[i+5*(n+d)-u.x,s-5*(l+h)-u.y]}draw_trace(){let t=new n.default.Line({points:this.points.slice(Math.max(this.points.length-4,0)),stroke:this.traceColor,x:this.bs/2,y:this.bs/2});this.world.ui.layers.line.add(t),this.world.ui.layers.line.draw()}add_point(t,e){const[i,s]=this.trace_point(t,e);this.points=this.points.concat([i,s]),this.draw_trace()}set_trace(t){this.traceColor=t,this.add_point(this.x,this.y)}set_speed(t){this.speed=t}clear_trace(){this.points=[],this.world.ui.layers.line.destroyChildren(),this.world.ui.layers.line.draw()}draw(){let[t,e]=this.cr2xy(this.x,this.y);if(this.image)n.default.Image.fromURL(this.image,(i=>{i.setAttrs({x:t,y:e,width:this.bs-15,height:this.bs-15,rotation:-90*this.orientation}),this.node=i,this.canvas.add(this.node),this.canvas.batchDraw()}));else{var i="data:image/svg+xml;base64,"+btoa('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" class="svg-triangle" width=\'100\' height=\'100\' fill="#008080">\n<path d="M 95,50 5,95 5,5 z"/>\n</svg>');n.default.Image.fromURL(i,(i=>{i.setAttrs({x:t,y:e,width:this.bs-15,height:this.bs-15,rotation:-90*this.orientation}),this.node=i,this.canvas.add(this.node),this.canvas.batchDraw()}))}}}},9367:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.WorldModel=void 0;const n=s(i(8995)),a=i(8451),r=s(i(9755)),o=s(i(1763)),l=s(i(3608)),d=s(i(2475)),h={normal:{x:50,y:25,stroke:"darkred",strokeWidth:10},removable:{x:50,y:25,stroke:"#de1738",strokeWidth:10},goal:{x:50,y:25,stroke:"darkred",strokeWidth:7,dash:[5,5]}};e.WorldModel=class{constructor(){this.init_ui()}init(t,e,i=[],s=[],n=[],r={},o={},l=[],d=[]){this.rows=t,this.cols=e,this.vwalls=i,this.hwalls=s,this.bs=Math.min(500/t,50),this.height=t*this.bs,this.width=e*this.bs,this.objects=r,this.tileMap=o,this.tiles=l,this.pending_goals=d,this.draw_canvas(),this.robots=n.map(((t,e)=>new a.RobotModel(e,this,t.x,t.y,t.orientation,t.image))),console.log(n),this.robots[0].draw()}init_ui(){let t=document.createElement("div");t.setAttribute("class","ttgt-wrapper");let e=document.createElement("div");e.setAttribute("id","container");let i=document.createElement("span"),s=document.createTextNode("Toggle");i.appendChild(s),i.setAttribute("class","bttn-txt");let a=document.createElement("button");a.appendChild(i),a.setAttribute("class","ttgt-sidebar-bttn"),a.onclick=function(){r.default("#container").toggle()},t.appendChild(e),t.appendChild(a),this.ui={wrapper:t,layers:{bg:new n.default.Layer({offsetY:-150}),main:new n.default.Layer({offsetY:-150}),line:new n.default.Layer({offsetY:-150})}}}draw_canvas(){let t=new n.default.Stage({container:"container",width:this.width+this.bs+25,height:this.height+this.bs+25+150});this.ui.layers.msg=new n.default.Layer({width:this.width+this.bs+25,height:150}),t.add(this.ui.layers.msg),t.add(this.ui.layers.bg),t.add(this.ui.layers.main),t.add(this.ui.layers.line),this.ui.stage=t,this.draw_border(),this.draw_grid(),this.draw_objects(),this.draw_msg_containers(),this.pending_goals.length>0?this.draw_pending_instructions(this.pending_goals,"red"):this.draw_pending_instructions(this.pending_goals),this.ui.layers.main.draw()}draw_msg_containers(){var t,e;let i=new n.default.Text({y:10,width:550,align:"center",verticalAlign:"center",height:20,fontSize:24,text:"Pending Tasks"});null===(t=this.ui.layers.msg)||void 0===t||t.add(i),null===(e=this.ui.layers.msg)||void 0===e||e.draw()}draw_pending_instructions(t=["No Goal"],e="black",i=16){var s;let a=this.ui.layers.msg,r=null===(s=this.ui.layers.msg)||void 0===s?void 0:s.find(".instruction_msg")[0];r&&r.destroy();let o=t.slice(0,6).join("\n\n"),l=Math.max((null==a?void 0:a.width())||0,200)-70,d=new n.default.Text({padding:20,text:o,x:40,y:40,align:"center",fill:e,verticalAlign:"center",fontSize:i,width:l,name:"instruction_msg-rect"}),h=new n.default.Rect({width:l,height:d.height(),cornerRadius:10,stroke:"black",x:40,y:40,name:"instruction_msg"});null==a||a.add(h),null==a||a.add(d),null==a||a.draw()}success_msg(t){var e,i;let s=null===(e=this.ui.layers.msg)||void 0===e?void 0:e.find(".instruction_msg")[0],n=null===(i=this.ui.layers.msg)||void 0===i?void 0:i.find(".instruction_msg-rect")[0];return s&&(s.destroy(),null==n||n.destroy()),this.draw_pending_instructions([].concat(t),"green",20)}draw_objects(){for(const t in this.objects){const[e,i]=t.split(",").map((t=>parseInt(t)));this.draw_object(e,i,this.objects[t])}}draw_object(t,e,i){for(const s in i){let n=this.parse_value(i[s]);"beeper"===s?this.draw_beeper(t,e,n):this.draw_custom(s,t,e,n)}}update_object(t,e,i){let s=this.ui.layers.main.find(`.obj-${t}-${e}-text`)[0];s&&(s.text(`${i}`),this.ui.layers.main.draw())}draw_beeper(t,e,i){let s=.6*this.bs/2,[a,r]=this.point2cxy(t+1,e);a+=this.bs/2;let o=new n.default.Circle({radius:s,x:a,y:r,fill:"yellow",stroke:"orange",strokeWidth:5,name:`obj-${t}-${e}-circle`}),l=new n.default.Text({text:`${i}`,x:a-5,y:r-7,fontSize:18,name:`obj-${t}-${e}-text`});this.ui.layers.main.add(o,l)}remove_object(t,e){let i=this.ui.layers.main.find(`.obj-${t}-${e}-circle`)[0],s=this.ui.layers.main.find(`.obj-${t}-${e}-text`)[0],n=this.ui.layers.main.find(`.obj-${t}-${e}-img`)[0];i&&i.destroy(),s&&s.destroy(),n&&n.destroy(),this.ui.layers.main.draw()}draw_custom(t,e,i,s){let a=this.tileMap[t],[r,o]=this.point2cxy(e+1,i);n.default.Image.fromURL(a,(t=>{t.setAttrs({x:r+this.bs/2-10,y:o-this.bs/2,width:this.bs-10,height:this.bs-10,name:`obj-${e}-${i}-img`}),this.ui.layers.main.add(t),this.ui.layers.main.batchDraw()}));let l=new n.default.Text({text:`${s}`,x:r+32,y:o+2,fontSize:16,name:`obj-${e}-${i}-text`});this.ui.layers.main.add(l)}parse_value(t){if(!t)return 0;if(o.default(t))return t;{const[e,i]=t.split("-").map((t=>parseInt(t)));return l.default(e,i)}}draw_border(){let t=new n.default.Rect({x:50,y:this.bs/2,stroke:"darkred",strokeWidth:10,closed:!0,width:this.width,height:this.height});this.ui.layers.main.add(t)}draw_grid(){this.draw_cols(),this.draw_rows(),this.draw_walls(),this.draw_tiles()}_draw_tile(t,e,i){let[s,a]=this.point2cxy(t,e),r=this.tileMap[i];n.default.Image.fromURL(r,(i=>{i.setAttrs({x:s+50,y:a-this.bs/2,width:this.bs,height:this.bs,name:`obj-${t}-${e}-tilebg`}),this.ui.layers.bg.add(i),this.ui.layers.bg.batchDraw()}))}draw_tiles(){this.tiles.forEach(((t,e)=>{t.forEach(((t,i)=>{t&&this._draw_tile(e+1,i+1,t)}))}))}draw_cols(){for(let t=1;t<this.cols;t++){let e=new n.default.Line({x:50,y:this.bs/2,stroke:"gray",points:[t*this.bs,5,t*this.bs,this.height-5]}),i=new n.default.Text({text:`${t}`,y:this.height+40,x:t*this.bs+25});this.ui.layers.main.add(e,i)}let t=new n.default.Text({text:`${this.cols}`,y:this.height+40,x:this.cols*this.bs+25});this.ui.layers.main.add(t)}draw_rows(){for(let t=1;t<this.rows;t++){let e=new n.default.Line({x:50,y:this.bs/2,stroke:"gray",points:[this.width-5,t*this.bs,5,t*this.bs]}),i=new n.default.Text({text:""+(this.rows+1-t),x:this.bs/2,y:t*this.bs-10});this.ui.layers.main.add(e,i)}let t=new n.default.Text({text:"1",x:25,y:this.rows*this.bs-10});this.ui.layers.main.add(t)}point2cxy(t,e){return[(t-1)*this.bs,this.height-(e-1)*this.bs]}draw_wall(t,e,i,s="normal"){let a=h[s],r=null,[o,l]=this.point2cxy(t,e);"east"===i&&(r=new n.default.Line(Object.assign(Object.assign({},a),{name:`vwall-${t}-${e}`,points:[o+this.bs,l-this.bs,o+this.bs,l]}))),"north"===i&&(r=new n.default.Line(Object.assign(Object.assign({name:`hwall-${t}-${e}`},a),{points:[o,l-this.bs,o+this.bs,l-this.bs]}))),r&&this.ui.layers.main.add(r)}remove_wall(t,e,i){if("north"!==i&&"east"!==i)return;let s=this.ui.layers.main.find(`.${"north"===i?"hwall":"vwall"}-${t}-${e}`)[0];s&&s.destroy(),this.ui.layers.main.draw()}draw_typed_wall(t,e,i,s){let[n,a,r]=d.default(Number(s).toString(2),3,"0");parseInt(r)?parseInt(a)?this.draw_wall(t,e,i,"removable"):this.draw_wall(t,e,i,"normal"):parseInt(n)&&this.draw_wall(t,e,i,"goal")}draw_walls(){this.hwalls.forEach(((t,e)=>{t.forEach(((t,i)=>{t?this.draw_typed_wall(e,i,"north",t):this.remove_wall(e,i,"north")}))})),this.vwalls.forEach(((t,e)=>{t.forEach(((t,i)=>{t?this.draw_typed_wall(e,i,"east",t):this.remove_wall(e,i,"east")}))}))}}},8657:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MODULE_NAME=e.MODULE_VERSION=void 0;const s=i(306);e.MODULE_VERSION=s.version,e.MODULE_NAME=s.name},1367:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.MazeView=e.MazeModel=void 0;const n=i(2565),a=i(8657);i(7204);const r=i(9367),o=new(s(i(9269)).default)({concurrency:1});class l extends n.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:l.model_name,_model_module:l.model_module,_model_module_version:l.model_module_version,_view_name:l.view_name,_view_module:l.view_module,_view_module_version:l.view_module_version,current_call:"{}",method_return:"{}"})}}e.MazeModel=l,l.serializers=Object.assign({},n.DOMWidgetModel.serializers),l.model_name="MazeModel",l.model_module=a.MODULE_NAME,l.model_module_version=a.MODULE_VERSION,l.view_name="MazeView",l.view_module=a.MODULE_NAME,l.view_module_version=a.MODULE_VERSION;class d extends n.DOMWidgetView{constructor(){super(...arguments),this.method_changed=()=>{let t=JSON.parse(this.model.get("current_call"));if("halt"===t.method_name)return this.halt();o.add((()=>new Promise((e=>{let i="function"==typeof this[t.method_name]?this[t.method_name].apply(this,t.params):null;console.log("current_call in promise -> new code",t);let s=this;Promise.resolve(i).then((function(e){let i=JSON.stringify({value:e,cb:+new Date,params:t.params,method:t.method_name});return console.log("setting return",i),s.model.set("method_return",i),s.model.save_changes(),i})).then(e)}))))},this.draw_all=(t,e,i,s,n=[],a={},r={},o=[],l=[])=>this.world_model.init(t,e,i,s,n,a,r,o,l),this.halt=()=>o.clear(),this.move_to=(t,e,i)=>{var s;return null===(s=this.world_model.robots[t])||void 0===s?void 0:s.move_to(e,i)},this.turn_left=t=>{var e;return null===(e=this.world_model.robots[t])||void 0===e?void 0:e.turn_left()},this.set_trace=(t,e)=>{var i;return null===(i=this.world_model.robots[t])||void 0===i?void 0:i.set_trace(e)},this.set_speed=(t,e)=>{var i;return null===(i=this.world_model.robots[t])||void 0===i?void 0:i.set_speed(e)},this.add_wall=(t,e,i)=>this.world_model.draw_wall(t,e,i),this.add_object=(t,e,i,s)=>this.world_model.draw_object(t,e,{[i]:s}),this.update_object=(t,e,i)=>this.world_model.update_object(t,e,i),this.remove_object=(t,e)=>this.world_model.remove_object(t,e),this.remove_wall=(t,e,i)=>this.world_model.remove_wall(t,e,i),this.set_succes_msg=t=>this.world_model.success_msg(t)}render(){this.method_changed(),this.listenTo(this.model,"change:current_call",this.method_changed),this.world_model||(this.world_model=new r.WorldModel,this.el.appendChild(this.world_model.ui.wrapper))}}e.MazeView=d},3889:(t,e,i)=>{(e=i(3645)(!1)).push([t.id,"#container {\n  position: fixed;\n  right: 40px;\n  bottom: 0;\n  min-width: 550px;\n  background-color: #fff;\n  border-left: 1px solid #aaa;\n  border-top: 1px solid #aaa;\n  z-index: 105;\n}\n\n.bttn-txt {\n  -webkit-transform: rotate(90deg);\n  -moz-transform: rotate(90deg);\n  -ms-transform: rotate(90deg);\n  -o-transform: rotate(90deg);\n  transform: rotate(90deg);\n  width: 100%;\n  display: inline-block;\n}\n\n.ttgt-sidebar-bttn {\n  position: fixed;\n  right: 0;\n  bottom: 0;\n  width: 40px;\n  background-color: #f8f5e1;\n\n  z-index: 105;\n  height: 500px;\n}\n\n.ttgt-wrapper {\n  position: absolute;\n  right: 0;\n  bottom: 0;\n  background-color: #fff;\n  border-left: 1px solid #aaa;\n  border-top: 1px solid #aaa;\n  z-index: 105;\n}\n\n.hide {\n  display: none;\n}\n\n.show {\n  display: inherit;\n}\n",""]),t.exports=e},7204:(t,e,i)=>{var s=i(3379),n=i(3889);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[t.id,n,""]]);s(n,{insert:"head",singleton:!1}),t.exports=n.locals||{}},306:t=>{"use strict";t.exports=JSON.parse('{"name":"ttgtcanvas2","version":"0.1.3","description":"A maze library","keywords":["jupyter","jupyterlab","jupyterlab-extension","widgets"],"files":["lib/**/*.js","dist/*.js","css/*.css"],"homepage":"https://github.com//ttgtcanvas2","bugs":{"url":"https://github.com//ttgtcanvas2/issues"},"license":"BSD-3-Clause","author":{"name":"Indresh Vishwakarma","email":"indresh@varsito.com"},"main":"lib/index.js","types":"./lib/index.d.ts","repository":{"type":"git","url":"https://github.com//ttgtcanvas2"},"scripts":{"build":"yarn run build:lib && yarn run build:nbextension && yarn run build:labextension:dev","build:prod":"yarn run build:lib && yarn run build:nbextension && yarn run build:labextension","build:labextension":"jupyter labextension build .","build:labextension:dev":"jupyter labextension build --development True .","build:lib":"tsc","build:nbextension":"webpack","clean":"yarn run clean:lib && yarn run clean:nbextension && yarn run clean:labextension","clean:lib":"rimraf lib","clean:labextension":"rimraf ttgtcanvas2/labextension","clean:nbextension":"rimraf ttgtcanvas2/nbextension/static/index.js","lint":"eslint . --ext .ts,.tsx --fix","lint:check":"eslint . --ext .ts,.tsx","prepack":"yarn run build:lib","test":"jest","watch":"npm-run-all -p watch:*","watch:lib":"tsc -w","watch:nbextension":"webpack --watch --mode=development","watch:labextension":"jupyter labextension watch ."},"dependencies":{"@jupyter-widgets/base":"^1.1.10 || ^2.0.0 || ^3.0.0 || ^4.0.0","konva":"^8.0.2","lodash":"^4.17.21","p-queue":"^7.1.0"},"devDependencies":{"@babel/core":"^7.5.0","@babel/preset-env":"^7.5.0","@jupyterlab/builder":"^3.0.0","@phosphor/application":"^1.6.0","@phosphor/widgets":"^1.6.0","@types/jest":"^26.0.0","@types/webpack-env":"^1.13.6","@typescript-eslint/eslint-plugin":"^3.6.0","@typescript-eslint/parser":"^3.6.0","acorn":"^7.2.0","css-loader":"^3.2.0","eslint":"^7.4.0","eslint-config-prettier":"^6.11.0","eslint-plugin-prettier":"^3.1.4","fs-extra":"^7.0.0","identity-obj-proxy":"^3.0.0","jest":"^26.0.0","mkdirp":"^0.5.1","npm-run-all":"^4.1.3","prettier":"^2.0.5","rimraf":"^2.6.2","source-map-loader":"^1.1.3","style-loader":"^1.0.0","ts-jest":"^26.0.0","ts-loader":"^8.0.0","typescript":"~4.1.3","webpack":"^5.0.0","webpack-cli":"^4.0.0"},"jupyterlab":{"extension":"lib/plugin","outputDir":"ttgtcanvas2/labextension/","sharedPackages":{"@jupyter-widgets/base":{"bundled":false,"singleton":true}}}}')}}]);