(self.webpackChunkttgtcanvas2=self.webpackChunkttgtcanvas2||[]).push([[367],{451:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.RobotModel=e.orientation_hash=void 0;const n=s(i(995)),a=(t,e)=>(t%e+e)%e,o=[[0,1],[-1,0],[0,-1],[1,0]];e.orientation_hash={EAST:0,NORTH:1,WEST:2,SOUTH:3};const r=[{x:10,y:10},{x:10,y:40},{x:40,y:40},{x:40,y:10}];e.RobotModel=class{constructor(t,e,i,s,o,r){this.points=[],this.traceColor="red",this.turn_left=()=>new Promise((t=>{this.orientation=a(this.orientation+1,4);let[e,i]=this.cr2xy(this.x,this.y);new n.default.Tween({node:this.node,rotation:a(-90*this.orientation,360),duration:2,x:e,y:i,onFinish:()=>{t("done"),this.node.rotation(a(-90*this.orientation,360)),this.add_point(this.x,this.y)}}).play()})),this.index=t,this.x=i,this.y=s,this.orientation=o,this.image=r,this.world=e,this.canvas=this.world.ui.layers.main}cr2xy(t,e){let[i,s]=this.world.point2cxy(t,e),n=r[this.orientation];return[i+50+n.x,s-25+n.y]}trace_point(t,e){let[i,s]=this.cr2xy(t,e),[n,l]=o[a(this.orientation-1,4)];console.log(n,l);let[d,h]=o[a(this.orientation-2,4)],u=r[this.orientation];return[i+5*(n+d)-u.x,s-5*(l+h)-u.y]}draw_trace(){let t=new n.default.Line({points:this.points.slice(Math.max(this.points.length-4,0)),stroke:this.traceColor,x:25,y:25});this.world.ui.layers.line.add(t),this.world.ui.layers.line.draw()}add_point(t,e){const[i,s]=this.trace_point(t,e);this.points=this.points.concat([i,s]),this.draw_trace()}set_trace(t){this.traceColor=t,this.add_point(this.x,this.y)}clear_trace(){this.points=[],this.world.ui.layers.line.destroyChildren(),this.world.ui.layers.line.draw()}move_to(t,e){return new Promise((i=>{let[s,a]=this.cr2xy(t,e);new n.default.Tween({node:this.node,x:s,y:a,duration:2,onFinish:()=>{this.x=t,this.y=e,console.log("finished",t,e),i("done"),this.add_point(t,e)}}).play()}))}draw(){let[t,e]=this.cr2xy(this.x,this.y);if(this.image)n.default.Image.fromURL(this.image,(i=>{i.setAttrs({x:t,y:e,width:35,height:35,rotation:-90*this.orientation}),this.node=i,this.canvas.add(this.node),this.canvas.batchDraw()}));else{var i="data:image/svg+xml;base64,"+btoa('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" class="svg-triangle" width=\'100\' height=\'100\' fill="#008080">\n<path d="M 95,50 5,95 5,5 z"/>\n</svg>');n.default.Image.fromURL(i,(i=>{i.setAttrs({x:t,y:e,width:35,height:35,rotation:-90*this.orientation}),this.node=i,this.canvas.add(this.node),this.canvas.batchDraw()}))}}}},148:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.WorldModel=void 0;const n=s(i(995)),a=i(451),o=s(i(755)),r=s(i(763)),l=s(i(608));e.WorldModel=class{constructor(){this.init_ui()}init(t,e,i={},s=[],n={}){this.rows=t,this.cols=e,this.walls=i,this.bs=50,this.height=t*this.bs,this.width=e*this.bs,this.objects=n,this.draw_canvas(),this.robots=s.map(((t,e)=>new a.RobotModel(e,this,t.x,t.y,t._orientation,t.image))),console.log(s),this.robots[0].draw()}init_ui(){let t=document.createElement("div");t.setAttribute("class","ttgt-wrapper");let e=document.createElement("div");e.setAttribute("id","container");let i=document.createElement("span"),s=document.createTextNode("Toggle");i.appendChild(s),i.setAttribute("class","bttn-txt");let a=document.createElement("button");a.appendChild(i),a.setAttribute("class","ttgt-sidebar-bttn"),a.onclick=function(){o.default("#container").toggle()},t.appendChild(e),t.appendChild(a),this.ui={wrapper:t,layers:{main:new n.default.Layer,line:new n.default.Layer,msg:new n.default.Layer}}}draw_canvas(){let t=new n.default.Stage({container:"container",width:this.width+this.bs+25,height:this.height+this.bs+25});t.add(this.ui.layers.main),t.add(this.ui.layers.line),t.add(this.ui.layers.msg),this.ui.stage=t,this.draw_border(),this.draw_grid(),this.draw_objects(),this.ui.layers.main.draw()}draw_objects(){for(const t in this.objects){const[e,i]=t.split(",").map((t=>parseInt(t)));this.draw_object(e,i,this.objects[t])}}draw_object(t,e,i){for(const s in i){let n=this.parse_value(i[s]);"beeper"===s?this.draw_beeper(t,e,n):this.draw_custom(s,t,e,n)}}update_object(t,e,i){let s=this.ui.layers.main.find(`.obj-${t}-${e}-text`)[0];s&&(s.text(`${i}`),this.ui.layers.main.draw())}draw_beeper(t,e,i){let[s,a]=this.point2cxy(t+1,e);s+=25;let o=new n.default.Circle({radius:15,x:s,y:a,fill:"yellow",stroke:"orange",strokeWidth:5,name:`obj-${t}-${e}-circle`}),r=new n.default.Text({text:`${i}`,x:s-5,y:a-7,fontSize:18,name:`obj-${t}-${e}-text`});this.ui.layers.main.add(o,r)}remove_object(t,e){let i=this.ui.layers.main.find(`.obj-${t}-${e}-circle`)[0],s=this.ui.layers.main.find(`.obj-${t}-${e}-text`)[0],n=this.ui.layers.main.find(`.obj-${t}-${e}-img`)[0];i&&i.destroy(),s&&s.destroy(),n&&n.destroy(),this.ui.layers.main.draw()}draw_custom(t,e,i,s){}parse_value(t){if(!t)return 0;if(r.default(t))return t;{const[e,i]=t.split("-").map((t=>parseInt(t)));return l.default(e,i)}}draw_border(){let t=new n.default.Rect({x:50,y:25,stroke:"darkred",strokeWidth:10,closed:!0,width:this.width,height:this.height});this.ui.layers.main.add(t)}draw_grid(){this.draw_cols(),this.draw_rows(),this.draw_walls()}draw_cols(){for(let t=1;t<this.cols;t++){let e=new n.default.Line({x:50,y:25,stroke:"gray",points:[t*this.bs,5,t*this.bs,this.height-5]}),i=new n.default.Text({text:`${t}`,y:this.height+40,x:t*this.bs+25});this.ui.layers.main.add(e,i)}let t=new n.default.Text({text:`${this.cols}`,y:this.height+40,x:this.cols*this.bs+25});this.ui.layers.main.add(t)}draw_rows(){for(let t=1;t<this.rows;t++){let e=new n.default.Line({x:50,y:25,stroke:"gray",points:[this.width-5,t*this.bs,5,t*this.bs]}),i=new n.default.Text({text:""+(this.rows+1-t),x:25,y:t*this.bs-10});this.ui.layers.main.add(e,i)}let t=new n.default.Text({text:"1",x:25,y:this.rows*this.bs-10});this.ui.layers.main.add(t)}point2cxy(t,e){return[(t-1)*this.bs,this.height-(e-1)*this.bs]}add_wall(t,e,i){let s=null,[a,o]=this.point2cxy(t,e);"east"===i&&(s=new n.default.Line({x:50,y:25,stroke:"darkred",strokeWidth:10,points:[a+this.bs,o-this.bs,a+this.bs,o]})),"north"===i&&(s=new n.default.Line({x:50,y:25,stroke:"darkred",strokeWidth:10,points:[a,o-this.bs,a+this.bs,o-this.bs]})),s&&this.ui.layers.main.add(s)}draw_walls(){for(const t in this.walls)if(Object.prototype.hasOwnProperty.call(this.walls,t)){const e=this.walls[t];let[i,s]=t.split(",").map((t=>parseInt(t)));e.map((t=>{this.add_wall(i,s,t)}))}}}},657:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MODULE_NAME=e.MODULE_VERSION=void 0;const s=i(306);e.MODULE_VERSION=s.version,e.MODULE_NAME=s.name},367:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.MazeView=e.MazeModel=void 0;const n=i(565),a=i(657);i(204);const o=i(148),r=new(s(i(269)).default)({concurrency:1});class l extends n.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:l.model_name,_model_module:l.model_module,_model_module_version:l.model_module_version,_view_name:l.view_name,_view_module:l.view_module,_view_module_version:l.view_module_version,current_call:"{}",method_return:"{}"})}}e.MazeModel=l,l.serializers=Object.assign({},n.DOMWidgetModel.serializers),l.model_name="MazeModel",l.model_module=a.MODULE_NAME,l.model_module_version=a.MODULE_VERSION,l.view_name="MazeView",l.view_module=a.MODULE_NAME,l.view_module_version=a.MODULE_VERSION;class d extends n.DOMWidgetView{constructor(){super(...arguments),this.method_changed=()=>{let t=JSON.parse(this.model.get("current_call"));r.add((()=>{let e="function"==typeof this[t.method_name]?this[t.method_name].apply(this,t.params):null;console.log("current_call in promise",t);let i=this;return Promise.resolve(e).then((function(e){let s=JSON.stringify({value:e,cb:+new Date,params:t.params,method:t.method_name});return console.log("setting return",s),i.model.set("method_return",s),i.model.save_changes(),s}))}))},this.draw_all=(t,e,i,s=[],n={})=>this.world_model.init(t,e,i,s,n),this.move_to=(t,e,i)=>{var s;return null===(s=this.world_model.robots[t])||void 0===s?void 0:s.move_to(e,i)},this.turn_left=t=>{var e;return null===(e=this.world_model.robots[t])||void 0===e?void 0:e.turn_left()},this.set_trace=(t,e)=>{var i;return null===(i=this.world_model.robots[t])||void 0===i?void 0:i.set_trace(e)},this.add_wall=(t,e,i)=>this.world_model.add_wall(t,e,i),this.update_object=(t,e,i)=>this.world_model.update_object(t,e,i),this.remove_object=(t,e)=>this.world_model.remove_object(t,e)}render(){this.method_changed(),this.listenTo(this.model,"change:current_call",this.method_changed),this.world_model||(this.world_model=new o.WorldModel,this.el.appendChild(this.world_model.ui.wrapper))}}e.MazeView=d},889:(t,e,i)=>{(e=i(645)(!1)).push([t.id,"#container {\n  position: fixed;\n  right: 40px;\n  bottom: 30px;\n  min-width: 550px;\n  background-color: #f8f5e1;\n  border-left: 1px solid #aaa;\n  border-top: 1px solid #aaa;\n  z-index: 105;\n}\n\n.bttn-txt {\n  -webkit-transform: rotate(90deg);\n  -moz-transform: rotate(90deg);\n  -ms-transform: rotate(90deg);\n  -o-transform: rotate(90deg);\n  transform: rotate(90deg);\n  width: 100%;\n  display: inline-block;\n}\n\n.ttgt-sidebar-bttn {\n  position: fixed;\n  right: 0;\n  bottom: 0;\n  width: 40px;\n  background-color: #f8f5e1;\n\n  z-index: 105;\n  height: 500px;\n}\n\n.ttgt-wrapper {\n  position: absolute;\n  right: 0;\n  bottom: 0;\n  background-color: #f8f5e1;\n  border-left: 1px solid #aaa;\n  border-top: 1px solid #aaa;\n  z-index: 105;\n}\n\n.hide {\n  display: none;\n}\n\n.show {\n  display: inherit;\n}\n",""]),t.exports=e},204:(t,e,i)=>{var s=i(379),n=i(889);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[t.id,n,""]]);s(n,{insert:"head",singleton:!1}),t.exports=n.locals||{}},306:t=>{"use strict";t.exports=JSON.parse('{"name":"ttgtcanvas2","version":"0.1.2","description":"A maze library","keywords":["jupyter","jupyterlab","jupyterlab-extension","widgets"],"files":["lib/**/*.js","dist/*.js","css/*.css"],"homepage":"https://github.com//ttgtcanvas2","bugs":{"url":"https://github.com//ttgtcanvas2/issues"},"license":"BSD-3-Clause","author":{"name":"Indresh Vishwakarma","email":"indresh@varsito.com"},"main":"lib/index.js","types":"./lib/index.d.ts","repository":{"type":"git","url":"https://github.com//ttgtcanvas2"},"scripts":{"build":"yarn run build:lib && yarn run build:nbextension && yarn run build:labextension:dev","build:prod":"yarn run build:lib && yarn run build:nbextension && yarn run build:labextension","build:labextension":"jupyter labextension build .","build:labextension:dev":"jupyter labextension build --development True .","build:lib":"tsc","build:nbextension":"webpack","clean":"yarn run clean:lib && yarn run clean:nbextension && yarn run clean:labextension","clean:lib":"rimraf lib","clean:labextension":"rimraf ttgtcanvas2/labextension","clean:nbextension":"rimraf ttgtcanvas2/nbextension/static/index.js","lint":"eslint . --ext .ts,.tsx --fix","lint:check":"eslint . --ext .ts,.tsx","prepack":"yarn run build:lib","test":"jest","watch":"npm-run-all -p watch:*","watch:lib":"tsc -w","watch:nbextension":"webpack --watch --mode=development","watch:labextension":"jupyter labextension watch ."},"dependencies":{"@jupyter-widgets/base":"^1.1.10 || ^2.0.0 || ^3.0.0 || ^4.0.0","konva":"^8.0.2","lodash":"^4.17.21","p-queue":"^7.1.0"},"devDependencies":{"@babel/core":"^7.5.0","@babel/preset-env":"^7.5.0","@jupyterlab/builder":"^3.0.0","@phosphor/application":"^1.6.0","@phosphor/widgets":"^1.6.0","@types/jest":"^26.0.0","@types/webpack-env":"^1.13.6","@typescript-eslint/eslint-plugin":"^3.6.0","@typescript-eslint/parser":"^3.6.0","acorn":"^7.2.0","css-loader":"^3.2.0","eslint":"^7.4.0","eslint-config-prettier":"^6.11.0","eslint-plugin-prettier":"^3.1.4","fs-extra":"^7.0.0","identity-obj-proxy":"^3.0.0","jest":"^26.0.0","mkdirp":"^0.5.1","npm-run-all":"^4.1.3","prettier":"^2.0.5","rimraf":"^2.6.2","source-map-loader":"^1.1.3","style-loader":"^1.0.0","ts-jest":"^26.0.0","ts-loader":"^8.0.0","typescript":"~4.1.3","webpack":"^5.0.0","webpack-cli":"^4.0.0"},"jupyterlab":{"extension":"lib/plugin","outputDir":"ttgtcanvas2/labextension/","sharedPackages":{"@jupyter-widgets/base":{"bundled":false,"singleton":true}}}}')}}]);