(self.webpackChunk=self.webpackChunk||[]).push([[4676],{842:(e,t,a)=>{"use strict";var n=a(85973),o=a.n(n),r=a(37213),s=a.n(r),c=a(55156),i=a(28995);!function(e){const t={};function a(e){void 0===t[e]&&(t[e]=e,$.ajax({url:build_url(Indico.Urls.Categories.info,{category_id:e}),dataType:"json",error(e){e.status&&403!==e.status&&handleAjaxError(e)},success(a){t[e]=a}}))}function n(e,t,a){const n=o()(t)?t.category.id:t,r={category_id:e};$("<div>").categorynavigator({category:t,confirmation:!0,openInDialog:!0,actionButtonText:i.$T.gettext("Move here"),dialogTitle:i.$T.ngettext("Move category","Move categories",e.length),dialogSubtitle:i.$T.ngettext("Select new category parent for the category","Select new category parent for {0} selected categories",e.length).format(e.length),actionOn:{categoriesDescendingFrom:{disabled:!0,ids:e},categories:{disabled:!0,groups:[{ids:[n],message:i.$T.ngettext("The category is already here","The selected categories are already here",e.length)},{ids:e,message:i.$T.ngettext("This is the category you are trying to move","This is one of the categories you are trying to move",e.length)}]}},onAction(e){$.ajax({url:a,type:"POST",data:$.extend({target_category_id:e.id},r),error:handleAjaxError,success(e){e.success&&location.reload()}})}})}function r(e,t,a){const n=o()(e)?e.category.id:e,r=a?a.all_selected?$("#event-management").data("total"):a.event_id.length:1;$("<div>").categorynavigator({category:e,confirmation:!0,openInDialog:!0,actionButtonText:i.$T.gettext("Move here"),dialogTitle:i.$T.ngettext("Move event","Move events",r),dialogSubtitle:i.$T.ngettext("Select category destination for the event","Select category destination for {0} selected events".format(r),r),actionOn:{categoriesWithoutEventCreationRights:{disabled:!0},categories:{disabled:!0,ids:[n],message:i.$T.ngettext("The event is already here","The selected events are already here",r)}},onAction(e){$.ajax({url:t,type:"POST",data:$.extend({target_category_id:e.id},a||{}),error:handleAjaxError,success(e){e.success&&location.reload()}})}})}e.setupCategoryMoveButton=function(e){e&&a(e),$(".js-move-category").on("click",(function(){const a=$(this);n([a.data("categoryId")],t[e],a.data("href"))}))},e.setupCategoryTable=function(e){a(e);const o=$("table.category-management"),r=o.find("tbody"),s=$(".js-bulk-delete-category"),c=$(".js-bulk-move-category"),l="tr[data-category-id]",d="input[name=category_id]";function g(){return r.find(l).map((function(){return $(this).data("category-id")})).toArray()}function u(e){return $.ajax({url:o.data("sort-url"),method:"POST",data:JSON.stringify({categories:e}),dataType:"json",contentType:"application/json",error:handleAjaxError})}function h(e){e?$(".banner .js-delete-category").removeClass("disabled").attr("title",i.$T.gettext("Delete category")):$(".banner .js-delete-category").addClass("disabled").attr("title",i.$T.gettext("This category cannot be deleted because it is not empty."))}function f(){return o.find(l).find(`${d}:checked`).map((function(){return this.value})).toArray()}function y(){return o.find(l).has(`${d}:checked`)}$(".js-sort-categories").on("click",(function(){const e=$(this).data("sort-order"),t=g();!function(e){r.find(l).sort((function(t,a){return e*strnatcmp($(t).data("category-title").toLowerCase(),$(a).data("category-title").toLowerCase())})).detach().appendTo(r)}(e),u(g()),cornerMessage({actionLabel:i.$T.gettext("Undo"),actionCallback:function(){var e;return e=t,$.each(e,(function(e,t){r.find(`[data-category-id=${t}]`).not(".js-move-category").detach().appendTo(r)})),u(t)},feedbackMessage:i.$T.gettext("The category order has been restored."),duration:1e4,message:i.$T.gettext("The category list has been sorted.")})})),c.on("click",(function(a){const o=$(this);a.preventDefault(),o.hasClass("disabled")||n(f(),t[e],o.data("href"))})),o.find(".js-move-category").on("click",(function(){const a=$(this);n([a.data("categoryId")],t[e],a.data("href"))})),o.find(".js-delete-category").on("indico:confirmed",(function(e){e.preventDefault();const t=$(this);$.ajax({url:t.data("href"),method:"POST",error:handleAjaxError,success(e){t.closest(l).remove(),h(e.is_parent_empty)}})})),enableIfChecked(r,d,s,(function(e){return 0===e.filter(":not([data-is-empty=true])").length})),s.on("click",(function(){const e=y();ajaxDialog({url:o.data("bulk-delete-url"),method:"POST",title:i.$T.gettext("Delete categories"),data:{category_id:f()},onClose(t){t&&t.success&&(e.find("input[type=checkbox]").prop("checked",!1),e.remove(),h(t.is_empty))}})})).qtip({suppress:!1,content:{text:function(){const e=y();return e.length?s.hasClass("disabled")?i.$T.gettext("At least one selected category cannot be deleted because it is not empty."):i.$T.ngettext("Delete the selected category","Delete {0} selected categories",e.length).format(e.length):i.$T.gettext("Select the categories to delete first.")}}}),enableIfChecked(r,d,c),c.qtip({suppress:!1,content:{text:function(){const e=y();return e.length?i.$T.ngettext("Move the selected category","Move the {0} selected categories",e.length).format(e.length):i.$T.gettext("Select the categories to move first.")}}}),r.sortable({axis:"y",containment:"parent",cursor:"move",handle:".js-handle",items:"> tr",tolerance:"pointer",update(){u(g())}})},e.setupCategoryEventList=function(e){let n=!1;a(e),enableIfChecked("#event-management","input[name=event_id]",".js-enabled-if-checked"),$(".event-management .js-move-event-to-subcategory").on("click",(function(a){a.preventDefault(),r(t[e],$(this).data("href"))})),$(".js-event-management-toolbar .js-move-events-to-subcategory").on("click",(function(a){if(a.preventDefault(),$(this).hasClass("disabled"))return;const o={};n()?o.all_selected=1:o.event_id=s()($("#event-management input[name=event_id]:checkbox:checked"),(function(e){return e.value})),r(t[e],$(this).data("href"),o)})),n=paginatedSelectAll({containerSelector:"#event-management",checkboxSelector:"input:checkbox[name=event_id]",allSelectedSelector:"input:checkbox[name=all_selected]",selectionMessageSelector:"#selection-message",totalRows:$("#event-management").data("total"),messages:{allSelected:e=>i.$T.ngettext("*","All {0} events in this category are currently selected.").format(e),pageSelected:(e,t)=>i.$T.ngettext("Only {0} out of {1} events is currently selected.","Only {0} out of {1} events are currently selected.",e).format(e,t)}}).isEverythingSelected},e.setupCategoryRolesList=function(){!function(){const e=$("#event-roles");e.on("click",".toggle-members",(function(){const e=$(this).closest("tr").next("tr").find(".slide");e.css("max-height",`${e[0].scrollHeight}px`),e.toggleClass("open close")})),e.on("indico:htmlUpdated",(function(){$(this).find(".slide").each((function(){$(this).css("max-height",`${this.scrollHeight}px`)}))}))}(),$("#event-roles").on("click",".js-add-members",(async e=>{e.stopPropagation();const t=$(e.target),a=await(0,c.E)({withExternalUsers:!0});a.length&&$.ajax({url:t.data("href"),method:t.data("method"),data:JSON.stringify({users:a}),dataType:"json",contentType:"application/json",error:handleAjaxError,complete:IndicoUI.Dialogs.Util.progress(),success(e){updateHtml(t.data("update"),e)}})}))}}(window)}},e=>{"use strict";e.O(0,[5514,3044,8592],(()=>{return t=842,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=module_categories.management.95211eb8.bundle.js.map