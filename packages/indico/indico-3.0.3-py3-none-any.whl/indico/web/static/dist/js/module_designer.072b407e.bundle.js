(self.webpackChunk=self.webpackChunk||[]).push([[1113],{33832:(t,e,i)=>{"use strict";var a=i(90567),n=i.n(a),o=i(86330),l=i.n(o),s=i(61941),c=i.n(s),d=i(11986),h=i.n(d),r=i(28995);!function(t){var e,i,a,o,s,d=!1,g=-1,u=!1,p={},f={},m=null,v={},b=null,k=null,w=!1,x=r.$T.gettext("The back side of the templates that use this one as the back side will be removed."),j=r.$T.gettext("Disassociate back sides"),_=!1;let y=null;function T(t){return y.includes(t)}function C(t){return t*s}function M(t){return t/s}function z(t,e){return t(/([0-9.]+)pt/g.exec(e)[1])+"pt"}var D=h()(z,C),q=h()(z,C);function F(t){var e={id:++g,type:t,x:a,y:o,font_family:"sans-serif",bold:!1,italic:!1,text_align:"center",color:"black",font_size:"15pt",width:T(t)?150:400,height:T(t)?150:null,text:(0,r.$T)("Fixed text"),selected:!1};return e.toHTML=function(){return $("<div>").addClass("designer-item").toggleClass("selected",this.selected).css({width:C(this.width),height:this.height?C(this.height):this.height,cursor:"move",fontWeight:this.bold?"bold":"normal",fontStyle:this.italic?"italic":"normal",fontFamily:this.font_family,fontSize:D(this.font_size),textAlign:this.text_align.replace("Justified","justify"),color:this.color}).attr("data-type",this.type).text("fixed"===this.type?this.text:v[this.type])}.bind(e),e}function H(t,e){this.realWidth=t,this.realHeight=e,this.width=C(t),this.height=C(e)}function O(t,e){var i=e?".template-side.back":".template-side.front",a=$("<div/>").css({position:"absolute",left:t.x+"px",top:t.y+"px",zIndex:g+10}).data("id",t.id).appendTo(i);return e||a.draggable({containment:i,stack:i+" > div",opacity:.5,drag:function(t,e){d&&(e.position.left=10*Math.floor(e.position.left/10),e.position.top=10*Math.floor(e.position.top/10))},stop:function(t,e){var i=$(this).data("id");p[i].x=M(e.position.left),p[i].y=M(e.position.top)}}),a}function W(t,e){if(t.length){var i=t.closest(".ui-draggable").data("id");return e?f[i]:p[i]}}function I(){return W($(".designer-item.selected"))}function P(t){var e=W(t);e&&(e.selected=!1,t.removeClass("selected"))}function L(t){var e=W(t);$(".element-tools").removeClass("hidden"),$(".second-row").removeClass("disappear"),$(".selection-text").html("fixed"===e.type?r.$T.gettext("Fixed text"):v[e.type]),P($(".designer-item.selected")),e.selected=!0,t.addClass("selected");var i=l()([e.bold?"bold":null,e.italic?"italic":null]);$("#alignment-selector").val(e.text_align),$("#font-selector").val(e.font_family),$("#size-selector").val(e.font_size),$("#style-selector").val(i.length?i.join("_"):"normal"),$("#color-selector").val(e.color),$(".js-element-width").val(e.width/a),$(".js-element-height").val(e.height/a);var n=$("#fixed-text-field");const o=$("#subtool-element-height");var s=$(".font-tools");"fixed"===e.type?(s.show(),n.closest(".tool").show(),n.val(e.text),o.hide()):T(e.type)?(s.hide(),n.closest(".tool").hide(),o.show()):(s.show(),n.closest(".tool").hide(),n.val(""),o.hide())}function A(){var t,n=Math.ceil(i.width/a),o=Math.ceil(e.width/a),l=Math.ceil(i.height/a),s=Math.ceil(e.height/a);if(e.width>i.width){var c=$("#horizontal-ruler");for(t=n;t<o;t++)$('<div class="marking"/>').attr("id","rulerh"+t).css({width:a+"px",left:t*a+"px",top:0}).html(t+1).appendTo(c)}else if(e.width<i.width)for(t=n;t>o;t--)$("#rulerh"+(t-1)).remove();if(e.height>i.height){var d=$("#vertical-ruler");for(t=l;t<s;t++)$('<div class="marking"/>').attr("id","rulerv"+t).css({"line-height":a/2+"px",height:a+"px",left:0,top:t*a+"px"}).html(t+1).appendTo(d)}else if(e.height<i.height)for(t=l;t>s;t--)$("#rulerv"+(t-1)).remove()}function E(t,n){var o=$(".template-container"),l=parseFloat($(".template-width").val()),s=parseFloat($(".template-height").val());o.width(Math.round(l*a)),o.height(Math.round(s*a)),i.width=e.width,i.height=e.height,e=new H(Math.round(50*l),Math.round(50*s)),A(),function(t,e){J(t),e.background_url&&J(e,!0)}(t,n),function(t,e){$(".js-preset-tool option").each((function(){var i=$(this);if("custom"!==i.val()){var a=i.data("width"),n=i.data("height");a===t&&n===e&&(i.prop("selected",!0),$(".js-template-dimension").prop("disabled",!0))}}))}(l,s)}function S(t){var e=I(),i=$(".designer-item.selected");i&&({font:function(){e.font_family=$("#font-selector").val()},color:function(){e.color=$("#color-selector").val()},alignment:function(){e.text_align=$("#alignment-selector").val()},size:function(){e.font_size=$("#size-selector").val()},style:function(){switch($("#style-selector").val()){case"normal":e.bold=!1,e.italic=!1;break;case"bold":e.bold=!0,e.italic=!1;break;case"italic":e.bold=!1,e.italic=!0;break;case"bold_italic":e.bold=!0,e.italic=!0}},text:function(){var t=$("#fixed-text-field");e.text=t.val().replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),t.val(e.text)},width:function(){e.width=Math.round($(".js-element-width").val()*a),"ticket_qr_code"===e.type&&($(".js-element-height").val($(".js-element-width").val()),e.height=e.width)},height:function(){e.height=Math.round($(".js-element-height").val()*a),"ticket_qr_code"===e.type&&($(".js-element-width").val($(".js-element-height").val()),e.width=e.height)}}[t](),i.replaceWith(e.toHTML()))}function U(t,i){if("stretch"===i)t.css({left:0,top:0}),t.height(e.height),t.width(e.width);else if("center"===i){var a,n=(o=t,(l=new Image).src=o.attr("src"),{width:l.width,height:l.height});t.height(n.height),t.width(n.width),t.width()>e.width||t.height()>e.height?(t.width()>e.width&&(a=e.width/t.width(),t.width(e.width),t.height(t.height()*a),t.css({left:0,top:e.height/2-t.height()/2+"px"})),t.height()>e.height&&(a=e.height/t.height(),t.width(t.width()*a),t.height(e.height),t.css({left:e.width/2-t.width()/2+"px",top:0}))):t.css({left:e.width/2-n.width/2+"px",top:e.height/2-n.height/2+"px"})}var o,l}function J(t,i){var a=i?".template-side.back":".template-side.front",n=$(a).find(".background-image"),o=t.data.background_position;n.attr({src:t.background_url}).css({position:"absolute",left:0,top:0,height:e.height+"px",width:e.width+"px",zIndex:5}).on("load",(function(){$("#loadingIcon").hide(),U($(this),o)})).appendTo(a)}function N(t,e){t.data&&(t.data.items.forEach((function(t){!function(t,e){delete t.id;var i=c()(F(),t);e?f[i.id]=i:p[i.id]=i}(t,e)})),function(t){var e=t?f:p;$.each(e,(function(e,i){var a=O(i,t);a.css({left:C(i.x)+"px",top:C(i.y)+"px"}),a.append(i.toHTML()),i.selected&&!t&&L(a.find(".designer-item"))}))}(e)),G(!(e&&t.data&&(t.data.items.length||t.background_url))),t.background_url&&J(t,e)}function B(t){var e=$(".template-side.back");t.background_url&&(t.background_url=null,e.find(".background-image").remove(),e.append($("<img>",{class:"background-image"}))),e.find(".designer-item").remove(),t.title=null,t.data=null,f={}}function G(t){var e=$(".backside-placeholder");e.parent().toggleClass("empty",t),e.toggle(t),$(".backside-tools").toggleClass("hidden",t)}function K(t){G(t),$(".backside-tools").toggleClass("hidden",!t),t?($(".backside-placeholder").addClass("to-be-removed"),$(".placeholder-text").html(r.$T.gettext("This back side template will be removed")),$(".placeholder-link").hide(),x=r.$T.gettext("The back side of this template will be removed"),j=r.$T.gettext("Disassociate back side"),_=!0):($(".backside-placeholder").removeClass("to-be-removed"),$(".placeholder-text").html(r.$T.gettext("The back side is empty.")),$(".placeholder-link").show(),x=r.$T.gettext("The back side of the templates that use this one as the back side will be removed."),j=r.$T.gettext("Disassociate back sides"),_=!1)}function Q(t,e,i,a){if($("#backside-warning").length||null!==m){var n=null;$("#backside-warning").length&&null!==m?n=$(".affected-targets-warning"):$("#backside-warning").length?n=$("#backside-warning"):null!==m&&(n=$("#frontside-warning")),50*t.val()!==i?(null!==m&&K(!0),n.show("fast"),w=!0):50*e.val()===a&&(n.hide("fast"),null!==m&&K(!1),w=!1)}}function R(){$("#frontside-warning").hide("fast"),K(!1),_=!1,w=!1}t.setupDesigner=function(t,l,c,h,g){u=!!t,v=Object.assign(...Object.values(h).map((t=>{let{options:e}=t;return e}))),s=c.zoom_factor,a=C(50),o=a,m=l.id,y=g,$(document).ready((function(){var i=$(".js-remove-bg").qtip();$('#bg-form input[type="file"]').on("change",(function(){var t=$(this);this.files&&t.next("label").removeClass("i-button").text(this.files[0].name),$(".js-upload-bg").attr("disabled",!t.val()).toggleClass("highlight",!!t.val())})),$(".template-content").on("mousedown",".designer-item",(function(){L($(this))})).on("dblclick",".designer-item",(function(){!function(t){var e=W(t);if("fixed"===e.type){var i=prompt("Enter fixed-text value",e.text);if(i){var a=t.parent(".ui-draggable");e.text=i,a.html(e.toHTML())}}}($(this))})),$(".js-upload-bg").click((function(){return $(".js-toggle-side.front").click(),$("#bg-form").submit(),!1})),$("#grid-snap").change((function(){d=this.checked})).change(),$("#bg-form").ajaxForm({dataType:"json",iframe:!1,success:function(e){e.error?alertPopup(e.error,(0,r.$T)("Error")):(t.background_url=e.image_url,J(t),$(".template-side.front").trigger("indico:backgroundChanged"))}}),$("input[name=bg-position]").change((function(e){e.preventDefault();var i=$(this).val();U($(".template-side.front .background-image"),i),t.data.background_position=i})),$(".js-remove-bg").click((function(e){e.preventDefault(),i.qtip("api").toggle(),function(t){t.background_url&&(t.background_url=null,$(".template-side.front").trigger("indico:backgroundChanged"))}(t)})),$(".move-button").click((function(t){t.preventDefault(),function(t){var i=I(),a=$(".designer-item.selected").parent();({left:function(){a&&(a.css("left",0),i.x=0)},right:function(){if(a){var t=e.width-a.width();a.css("left",t>0?t+"px":0),i.x=M(t>0?t:0)}},center:function(){if(a){var t=(e.width-a.width())/2,n=(e.height-a.height())/2;a.css("left",t>0?t+"px":0),a.css("top",n>0?n+"px":0),i.x=M(t>0?t:0),i.y=M(n>0?n:0)}},top:function(){a&&(a.css("top",0),i.y=0)},bottom:function(){if(a){var t=e.height-a.height();a.css("top",t>0?t+"px":0),i.y=M(t>0?t:0)}}})[t]()}($(this).data("direction"))})),$(".js-font-tool").change((function(){S($(this).data("attr"))})),$(".insert-element-btn").click((function(t){var i,n,l;t.preventDefault(),$(".js-toggle-side.front").click(),i=F($("#element-list").val()),n=O(i),l=i.toHTML().appendTo(n),p[i.id]=i,L(l),o+=a,o%=e.height-20})),$(".js-remove-element").click((function(t){var e,i;t.preventDefault(),e=$(".designer-item.selected"),(i=I())&&(delete p[i.id],e.remove(),$(".element-tools").addClass("hidden"))})),$(".js-save-template").click((function(i){i.preventDefault(),function(t){if(""!==$(".js-template-name").val())if(Object.keys(p).length||t.background_url){_&&(m=null);var i={template:{width:e.realWidth,height:e.realHeight,background_position:$("input[name=bg-position]:checked").val(),items:n()(p).map((function(t){return $.extend(!0,{},t).font_size=q(t.font_size),t}))},clear_background:!t.background_url,title:$(".js-template-name").val(),is_clonable:$('input[name="is-clonable"]:checked').length>0,backside_template_id:m};(w?confirmPrompt(r.$T.gettext("Are you sure you want to change the dimensions of this template?")+x,j):$.Deferred().resolve()).then((function(){$.ajax({url:location.pathname,data:JSON.stringify(i),contentType:"application/json",method:"POST",complete:IndicoUI.Dialogs.Util.progress(),error:handleAjaxError,success:function(t){b=e.width,k=e.height,_&&($(".affected-targets-warning").hide("fast"),K(!1),$(".js-remove-backside").click(),_=!1,w=!1),handleFlashes(t,!0)}})}))}else alertPopup(r.$T.gettext("The template cannot be empty. Add some elements or a background image."),r.$T.gettext("Warning"));else alertPopup(r.$T.gettext("Please choose a name for the template"),(0,r.$T)("Warning"))}(t)})),$(".template-width, .template-height").on("input",(function(){E(t,l)})),$(".js-element-width").on("keyup click",(function(){S("width")})),$(".js-element-height").on("keyup click",(function(){S("height")})),$("#fixed-text-field").on("keyup",(function(){S("text")})),$(".js-preset-tool").on("change",(function(){var e=$(this).find("option:selected");"custom"!==e.val()&&($(".template-width").val(e.data("width")).change(),$(".template-height").val(e.data("height")).change(),E(t,l)),$(".js-template-dimension").prop("disabled","custom"!==e.val())})),$(".js-toggle-side").on("click",(function(){var t=$(this),e=t.hasClass("front")?"front":"back",i=$(".designer-item.selected"),a=l.data&&(l.data.items.length||l.background_url);$(".template-content").toggleClass("flipped","back"===e),$(".template-side.back").toggleClass("active","back"===e),$(".template-side.front").toggleClass("active","front"===e),$(".backside-tools").toggleClass("hidden","front"===e||!a),$(".js-toggle-side").removeClass("highlight"),$(".element-tools").addClass("hidden"),$(".js-hide-on-flip").toggle("back"!==e),$(".js-invisible-on-flip").toggleClass("disappear","back"===e),t.toggleClass("highlight"),i&&i[0]&&P(i),$(".template-side.active").trigger("indico:backgroundChanged")})),$(".template-side").on("indico:backgroundChanged",(function(){var e=$("#backgroundFile"),i=$(".template-side.front"),a=i.find(".background-image");!t.background_url&&a.attr("src")&&(a.remove(),i.append($("<img>",{class:"background"})),e.val(""),e.next("label").addClass("i-button").text(r.$T.gettext("Choose a file"))),$(".js-upload-bg").attr("disabled",!e.val()),$(".js-remove-bg").attr("disabled",!t.background_url),$("#bg-position-stretch").prop("checked","stretch"===t.data.background_position),$("#bg-position-center").prop("checked","center"===t.data.background_position)})),$(".template-side.front").trigger("indico:backgroundChanged"),$(".template-side.back").on("indico:backsideUpdated",(function(t,e){m=e.backside_template_id,B(l),N(e.template,!0),l=e.template,_&&R(),$(".backside-template-title, .js-front-affected-title").text(e.template.title)})),$(".js-remove-backside").on("click",(function(){m=null,B(l),_&&R(),G(!0)})),$(".js-change-orientation").on("click",(function(){var e=$(".template-width"),i=$(".template-height"),a=e.val();e.val(i.val()).change(),i.val(a).change(),E(t,l)})),$(".js-backside-list-dialog").on("click",(function(){var t=$(this);ajaxDialog({trigger:t,url:t.data("href"),data:{width:e.realWidth,height:e.realHeight},title:t.data("title")})})),$(".backside-tools").addClass("hidden");var s=$(".template-width"),c=$(".template-height");s.on("change input",(function(){Q($(this),c,b,k)})),c.on("change input",(function(){Q($(this),s,k,b)})),$(".js-back-affected").qbubble({overwrite:!0,position:{target:$(".js-back-affected")},content:{text:$(".back-warning-qtip-content").html()},hide:{event:"unfocus click"},show:{event:"click"}}),$(".js-front-affected").qbubble({overwrite:!0,position:{target:$(".js-front-affected")},content:{text:function(){return $(".front-warning-qtip-content").html()}},hide:{event:"unfocus click"},show:{event:"click"}})})),u?(e=new H(t.data.width,t.data.height),$(".js-template-name").val(t.title),$(".js-is-clonable").prop("checked",t.is_clonable),$(".template-container").width(e.width).height(e.height)):e=new H(c.tpl_size[0],c.tpl_size[1]),i=new H(0,0),$(".template-width").val(e.width/a),$(".template-height").val(e.height/a),b=e.width,k=e.height,A(),E(t,l),N(t),N(l,!0)}}(window)},2666:(t,e,i)=>{var a=i(11396),n=i(32544),o=i(5850),l=n((function(t,e){a(e,o(e),t)}));t.exports=l},61941:(t,e,i)=>{t.exports=i(2666)}},t=>{"use strict";t.O(0,[8592],(()=>{return e=33832,t(t.s=e);var e}));t.O()}]);
//# sourceMappingURL=module_designer.072b407e.bundle.js.map