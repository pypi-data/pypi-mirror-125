(self.webpackChunk=self.webpackChunk||[]).push([[8749],{42959:(e,t,a)=>{"use strict";var o=a(63025),n=a(53806),i=a.n(n),r=a(12394);const c=o.ZP.bind(null,{endpoint:"rb.check_room_available",rules:[{args:["room_id"],converters:{room_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"rooms",isDynamic:!1},{data:"/",isDynamic:!1},{data:"api",isDynamic:!1},{data:"/",isDynamic:!1},{data:"rooms",isDynamic:!1},{data:"/",isDynamic:!1},{data:"room_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"availability",isDynamic:!1},{data:"/",isDynamic:!1},{data:"simple",isDynamic:!1}]}]},"/"),s=o.ZP.bind(null,{endpoint:"rb.roombooking",rules:[{args:["path"],converters:{path:"PathConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"rooms",isDynamic:!1},{data:"/",isDynamic:!1},{data:"path",isDynamic:!0}]},{args:[],converters:{},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"rooms",isDynamic:!1},{data:"/",isDynamic:!1}]}]},"/");window.setupEventCreationDialog=function(e){e=$.extend({categoryField:null,protectionModeFields:null,initialCategory:null,checkAvailability:!1,rbExcludedCategories:null,serverDefaultTimezone:null},e);const t=$($.parseHTML($("#event-creation-protection-messages").html())),a=$("<div>",{class:"form-group",css:{marginTop:"5px"}}),o=$("#event-creation-create_booking"),n=$("#room-available"),d=$("#room-available-prebook"),l=$("#room-conflict-booking"),m=$("#room-conflict-prebooking"),v=$("#room-conflict-prebooking-prebook"),g=$("#room-user-booking"),p=$("#room-user-prebooking"),u=$("#room-unbookable"),f=$("#room-cannot-book"),h=$("#create-booking"),D=$("#create-prebooking"),b=$("#create-booking-over-prebooking"),k=$("#create-prebooking-over-prebooking");let y,Y,_,M,H,T,S,C=null,F=!1;function O(){let o=e.protectionModeFields.filter(":checked").val();"inheriting"===o&&(o=C.is_protected?"inheriting-protected":"inheriting-public");const n=t.filter(".{0}-protection-message".format(o));n.find(".js-category-title").text(C.title),a.html(n)}function E(e){_=i()(`${e.date} ${e.time}`,"YYYY-MM-DD HH:mm"),M=i()(_).add(e.duration,"minutes")}function x(t){return e.rbExcludedCategories.some((e=>parseInt(e.id,10)===t))}function A(e){const t={path:"calendar",date:_.format("YYYY-MM-DD"),text:T.room_name},a=s(t);e.find("a").prop("href",a)}function L(e){Y&&(e&&($("#availability-messages").find("input[id^='create']").prop("checked",!1),o.val("false")),Y.hide())}function P(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(L(t),!("room_id"in T)||!_.isValid()||!M.isValid()||!_.isSame(M,"day")||_.isSameOrAfter(M)||x(H.id)||S!==e.serverDefaultTimezone||F)return void o.val("false");const a={room_id:T.room_id,start_dt:_.format(i().HTML5_FMT.DATETIME_LOCAL),end_dt:M.format(i().HTML5_FMT.DATETIME_LOCAL)};$.ajax({url:c(a),method:"GET",dataType:"json",contentType:"application/json",error:handleAjaxError,success(e){(e=(0,r.k)(e)).userBooking?(o.val("false"),Y=g,A(Y)):e.userPrebooking?(o.val("false"),Y=p,A(Y)):e.conflictBooking?(o.val("false"),Y=l,A(Y)):e.unbookable?(o.val("false"),Y=u,A(Y)):e.conflictPrebooking?e.canBook?(o.val(String(b[0].checked)),Y=m,A(Y)):e.canPrebook?(o.val(String(k[0].checked)),Y=v,A(Y)):(o.val("false"),Y=f):e.canBook?(o.val(String(h[0].checked)),Y=n):e.canPrebook?(o.val(String(D[0].checked)),Y=d):(o.val("false"),Y=f),Y.show()}})}a.appendTo(e.protectionModeFields.closest(".form-field")),e.categoryField.on("indico:categorySelected",((t,a)=>{C||(e.protectionModeFields.prop("disabled",!1),e.protectionModeFields.filter("[value=inheriting]").prop("checked",!0)),C=a,O()})),e.protectionModeFields.on("change",(function(){O()})),e.initialCategory?e.categoryField.trigger("indico:categorySelected",[e.initialCategory]):e.protectionModeFields.prop("disabled",!0),e.checkAvailability&&(function(){const e=$("#event-creation-start_dt-datestorage").val(),t=$("#event-creation-start_dt-timestorage").val(),a=$("#event-creation-end_dt-datestorage").val(),o=$("#event-creation-end_dt-timestorage").val(),n=$("#event-creation-occurrences").val(),r=n?JSON.parse(n):null;T=JSON.parse($("#event-creation-location_data").val()),S=$("#event-creation-timezone").val(),H=JSON.parse($("#event-creation-category").val()),r&&1===r.length?E(r[0]):(_=i()(`${e} ${t}`,"DD/MM/YYYY HH:mm"),M=i()(`${a} ${o}`,"DD/MM/YYYY HH:mm"))}(),$("#event-creation-location_data").on("change",(function(){T=JSON.parse($(this).val()),y!==T.room_id&&(y=T.room_id,P(!0))})),$("#event-creation-start_dt-datestorage").on("change",(function(){const e=$(this).val(),t=$("#event-creation-start_dt-timestorage").val(),a=$("#event-creation-end_dt-datestorage").val(),o=$("#event-creation-end_dt-timestorage").val();_=i()(`${e} ${t}`,"DD/MM/YYYY HH:mm"),M=i()(`${a} ${o}`,"DD/MM/YYYY HH:mm"),M.isBefore(_)&&(M=i()(`${e} ${o}`,"DD/MM/YYYY HH:mm")),P()})),$("#event-creation-start_dt-timestorage").on("change",(function(){const e=$("#event-creation-start_dt-datestorage").val(),t=$("#event-creation-start_dt-timestorage").val();_=i()(`${e} ${t}`,"DD/MM/YYYY HH:mm"),P()})),$("#event-creation-end_dt-datestorage").on("change",(function(){const e=$(this).val(),t=$("#event-creation-end_dt-timestorage").val();M=i()(`${e} ${t}`,"DD/MM/YYYY HH:mm"),P()})),$("#event-creation-end_dt-timestorage").on("change",(function(){const e=$("#event-creation-end_dt-datestorage").val(),t=$(this).val();M=i()(`${e} ${t}`,"DD/MM/YYYY HH:mm"),P()})),$("#event-creation-occurrences").on("change",(function(){const e=JSON.parse($(this).val());1===e.length?(E(e[0]),F=!1):F=!0,P()})),$("#event-creation-timezone").on("change",(function(){S=$(this).val(),P()})),$("#event-creation-category").on("change",(function(){H=JSON.parse($(this).val()),P()})),h.add(D).add(b).add(k).on("change",(function(){o.val(String(this.checked))})))}}},e=>{"use strict";e.O(0,[8592],(()=>{return t=42959,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=module_events.creation.5fa2ba61.bundle.js.map