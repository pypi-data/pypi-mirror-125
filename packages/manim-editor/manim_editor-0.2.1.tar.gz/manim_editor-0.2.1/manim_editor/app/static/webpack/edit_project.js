(()=>{"use strict";var e={401:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferPresentation=void 0;const n=s(440),i=s(646);class o extends n.Presentation{constructor(e,t,s){super(e),this.past_sections_to_buffer=t,this.future_sections_to_buffer=s}update_source(){for(let e=this.current_section+1,t=Math.min(this.current_section+this.future_sections_to_buffer+1,this.sections.length);e<t;++e)this.sections[e].load();for(let e=0,t=this.current_section-this.past_sections_to_buffer;e<t;++e)this.sections[e].unload()}add_section(e,t){this.sections.push(new i.BufferSection(e,t))}}t.BufferPresentation=o},646:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferSection=void 0;const n=s(83);class i extends n.Section{constructor(e,t){super(e,t),this.media_source=new MediaSource,this.media_buffer=null,this.media_source.onsourceopen=e=>{let t='video/mp4; codecs="avc1.64002A"';if(!("MediaSource"in window)||!MediaSource.isTypeSupported(t))return console.error("MediaSource or mime codec not supported"),void this.media_source.endOfStream();let s=this.media_source.addSourceBuffer(t);s.onupdateend=e=>{this.media_source.endOfStream()},s.onerror=e=>{console.error("Failed to append buffer to source buffer:"),console.error(this.media_source)},s.onabort=e=>{console.error("Aborted source buffer:"),console.error(this.media_source)},this.load((()=>{null!=this.media_buffer?s.appendBuffer(this.media_buffer):s.abort()}),(()=>{s.abort()}))}}load(e=null,t=null){if(null!==this.media_buffer)return void(null!==e&&e());let s=new XMLHttpRequest;s.responseType="arraybuffer",s.onload=()=>{this.media_buffer=s.response,console.log(`Section '${this.name}' successfully loaded`),null!==e&&e()},s.onerror=()=>{console.error(`Section '${this.name}' failed to load`),null!==t&&t()},s.open("GET",this.video,!0),s.send()}unload(){this.media_buffer=null}get_src_url(){return URL.createObjectURL(this.media_source)}}t.BufferSection=i},962:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FallbackPresentation=void 0;const n=s(440),i=s(527);class o extends n.Presentation{add_section(e,t){this.sections.push(new i.FallbackSection(e,t))}}t.FallbackPresentation=o},527:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FallbackSection=void 0;const n=s(83);class i extends n.Section{get_src_url(){return this.video}}t.FallbackSection=i},440:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Presentation=void 0;const n=s(141),i=s(83);t.Presentation=class{constructor(e){this.current_video=1,this.sections=[],this.current_section=-1,this.previous_section=-1,this.next_section=0,this.cache_batch_size=e,this.video0=document.getElementById("video0"),this.video1=document.getElementById("video1"),this.videos_div=document.getElementById("videos-div"),this.timeline_sections=document.getElementsByClassName("timeline-element"),this.timeline_indicators=document.getElementsByClassName("timeline-indicator");let t=this.videos_div.dataset.project_file;(0,n.get_json)(t,(e=>{for(let t=0;t<e.length;++t){let s=this.timeline_sections[t].dataset.video;this.add_section(e[t],s)}console.log(`All ${e.length} sections have been parsed successfully.`),this.attach_timeline(),this.play_section(0)}))}update_video(){if(this.current_section==this.previous_section)return this.get_current_video().currentTime=0,void this.get_current_video().play();let e=this.sections[this.current_section],t=this.get_current_video();this.current_video=0==this.current_video?1:0;let s=this.get_current_video();switch(s.src=e.get_src_url(),s.style.visibility="visible",e.get_type()){case i.SectionType.SKIP:s.onended=e=>{++this.current_section,this.next_section=this.current_section,this.update_video()};break;case i.SectionType.LOOP:s.onended=e=>{this.update_video()};break;case i.SectionType.COMPLETE_LOOP:s.onended=e=>{this.current_section=this.next_section,this.update_video()};break;default:s.onended=e=>{}}console.log(`Playing section '${e.get_name()}'`),s.play().then((()=>{t.pause(),t.style.visibility="hidden"})),this.update_timeline(),this.update_source(),this.previous_section=this.current_section}pause(){this.get_current_video().pause()}play(){this.get_current_video().play()}play_section(e,t=!1){e<0||e>=this.sections.length?console.error(`Trying to switch to invalid section index #${e}`):(console.log(`Switching to section '${this.sections[e].get_name()}'`),-1==this.current_section||this.sections[this.current_section].get_type()!=i.SectionType.COMPLETE_LOOP||t?(this.next_section=e,this.current_section=e,this.update_video()):this.next_section=e)}play_next_section(){this.play_section(this.current_section+1)}restart_current_section(){this.play_section(this.current_section,!0)}play_previous_section(){this.play_section(this.current_section-1,!0)}attach_timeline(){for(let e=0;e<this.timeline_sections.length;++e)this.timeline_sections[e].addEventListener("click",(()=>{this.play_section(e,!0)}))}update_timeline(){-1!=this.previous_section&&(this.timeline_indicators[this.previous_section].innerHTML='<i class="timeline-indicators bi-check-circle" role="img"></i>'),this.timeline_indicators[this.current_section].innerHTML='<i class="timeline-indicators bi-circle-fill" role="img"></i>',this.timeline_sections[this.current_section].scrollIntoView({behavior:"smooth",block:"center"})}get_current_section(){return this.current_section}get_current_video(){return 0==this.current_video?this.video0:this.video1}cache_batch(e,t){let s=e;for(let n=e,i=Math.min(e+this.cache_batch_size,this.sections.length);n<i;++n)this.sections[n].cache((()=>{++s,s==this.sections.length?(console.log(`Batch caching complete with offset ${e}`),console.log("Caching complete"),t()):s==e+this.cache_batch_size&&(console.log(`Batch caching complete with offset ${e}`),this.cache_batch(s,t))}))}cache(e){this.cache_batch(0,e)}enter_fullscreen(){this.videos_div.requestFullscreen&&this.videos_div.requestFullscreen()}exit_fullscreen(){document.exitFullscreen&&document.exitFullscreen()}fullscreen_status(){return null!=document.fullscreenElement}toggle_fullscreen(){this.fullscreen_status()?this.exit_fullscreen():this.enter_fullscreen()}update_source(){}}},83:(e,t)=>{var s;function n(e){switch(e){case"presentation.normal":return s.NORMAL;case"presentation.loop":return s.LOOP;case"presentation.skip":return s.SKIP;case"presentation.complete_loop":return s.COMPLETE_LOOP;default:return console.error(`Unsupported section type '${e}'`),s.NORMAL}}Object.defineProperty(t,"__esModule",{value:!0}),t.Section=t.get_section_type=t.SectionType=void 0,function(e){e[e.NORMAL=0]="NORMAL",e[e.LOOP=1]="LOOP",e[e.SKIP=2]="SKIP",e[e.COMPLETE_LOOP=3]="COMPLETE_LOOP"}(s=t.SectionType||(t.SectionType={})),t.get_section_type=n,t.Section=class{constructor(e,t){this.type=n(e.type),this.name=e.name,this.id=e.in_project_id,this.video=t}cache(e){let t=new XMLHttpRequest;t.onload=()=>{200==t.status?(console.log(`Cached section '${this.name}'`),e()):console.error(`Section '${this.name}' failed to be cached with status ${t.status}`)},t.onerror=()=>{console.error(`Section '${this.name}' failed to be cached`)},t.open("GET",this.video,!0),t.send()}get_type(){return this.type}get_name(){return this.name}get_id(){return this.id}}},141:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.spin_button=t.flash=t.get_json=t.send_json=void 0,t.send_json=function(e,t,s){let n=new XMLHttpRequest;n.onload=()=>{200==n.status?s(JSON.parse(n.responseText)):console.error(`Failed POST to '${e}' with status ${n.status}.`)},n.onerror=()=>{console.error(`Failed to POST to '${e}'.`)},n.open("POST",e,!0),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.send(JSON.stringify(t))},t.get_json=function(e,t){let s=new XMLHttpRequest;s.onload=()=>{200==s.status?t(JSON.parse(s.responseText)):console.error(`Failed to load json '${e}' with status ${s.status}`)},s.onerror=()=>{console.error(`Failed to load json '${e}'`)},s.open("GET",e,!0),s.send()},t.flash=function(e,t){let s=document.getElementById("flashes"),n=document.createElement("div");s.appendChild(n),n.innerHTML=`<div class="alert alert-${t} alert-dismissible fade show mt-3" role="alert">\n            ${e}\n            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>\n         </div>`},t.spin_button=function(e){e.disabled=!0,e.innerText="";let t=document.createElement("div");e.appendChild(t),t.innerHTML='<div>\n            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n            Loading...\n        </div>'}}},t={};function s(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,s),o.exports}(()=>{const e=s(141),t=s(401),n=s(962),i=s(141);let o=5,r=2,c=5,a=!1,l=new URLSearchParams(location.search);document.body.onload=()=>{l.has("cache_batch_size")&&(o=Number(l.get("cache_batch_size"))),l.has("past_sections_to_buffer")&&(r=Number(l.get("past_sections_to_buffer"))),l.has("future_sections_to_buffer")&&(c=Number(l.get("future_sections_to_buffer"))),l.has("use_fallback_loader")&&(a="true"===l.get("use_fallback_loader"));let s=a?(console.log(`Using FallbackPresentation with a cache batch size of ${o}.`),new n.FallbackPresentation(o)):(console.log(`Using BufferPresentation with ${c} sections to auto load, ${r} sections to keep and a cache batch size of ${o}.`),new t.BufferPresentation(o,c,r));(function(t){let s=document.getElementById("previous-section"),n=document.getElementById("restart-section"),d=document.getElementById("next-section"),u=document.getElementById("pause"),_=document.getElementById("fullscreen"),h=document.getElementById("cache"),p=document.getElementById("update-settings");s.addEventListener("click",t.play_previous_section.bind(t)),n.addEventListener("click",t.restart_current_section.bind(t)),d.addEventListener("click",t.play_next_section.bind(t)),u.addEventListener("click",t.pause.bind(t)),_.addEventListener("click",t.enter_fullscreen.bind(t)),h.addEventListener("click",(()=>{(0,e.spin_button)(h),t.cache((()=>{h.remove()}))}));let f=document.getElementById("cache-batch-size"),m=document.getElementById("past-sections-to-buffer"),v=document.getElementById("future-sections-to-buffer"),b=(document.getElementById("fallback-loader-selected"),document.getElementById("fallback-loader-selected"));f.value=o.toString(),m.value=r.toString(),v.value=c.toString(),b.checked=a,p.addEventListener("click",(()=>{parseInt(f.value)>0&&(o=parseInt(f.value)),parseInt(m.value)>0&&(r=parseInt(m.value)),parseInt(v.value)>0&&(c=parseInt(v.value)),a=b.checked,l.set("cache_batch_size",o.toString()),l.set("past_sections_to_buffer",c.toString()),l.set("future_sections_to_buffer",r.toString()),l.set("use_fallback_loader",a.toString()),window.history.replaceState({},"",`${location.pathname}?${l.toString()}`),location.reload()}));let g=document.getElementById("export-presentation");if(null!==g){let t=g.dataset.target,s=g.dataset.name;g.addEventListener("click",(()=>{(0,e.spin_button)(g),(0,i.send_json)(t,{name:s},(e=>{e.success?(null==g||g.remove(),(0,i.flash)("The project has been exported, copy the project directory into a web server to serve it. More information can be found in the documentation.","success")):(0,i.flash)(`The editor unexpectedly failed to export the project '${s}' as a presentation. For more information see the console log. Please consider opening an Issue on GitHub if this problem persists.`,"danger")}))}))}})(s),function(e){const t=["ArrowLeft","ArrowDown","PageDown","Backspace"],s=["ArrowRight","ArrowUp","PageUp","Enter","Space"],n=["P"],i=["KeyF"];document.addEventListener("keydown",(o=>{o.repeat||(t.includes(o.code)?e.play_previous_section():s.includes(o.code)?e.play_next_section():n.includes(o.code)?e.pause():i.includes(o.code)&&e.toggle_fullscreen())}))}(s)}})()})();