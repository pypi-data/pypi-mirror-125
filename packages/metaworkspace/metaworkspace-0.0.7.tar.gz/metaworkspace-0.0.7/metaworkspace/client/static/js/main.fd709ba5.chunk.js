(this["webpackJsonpmetaworkspace-react"]=this["webpackJsonpmetaworkspace-react"]||[]).push([[0],{128:function(e,t,n){},228:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),r=n(33),c=n.n(r),s=n(120),o=n(36),l=n(21),u=(n(128),n(129),"/app"),d="/app/login",h="/app/view/:project_name",f="/app/view/",m="/app/projects/:project_name?",j="/app/projects/",p="/app/jobs",b="/app/upload/:project_name",v="/app/upload/",g="/api/projects",x="/api/project",O="/api/project/rename",_="/api/project",y="/api/project/build",w="/api/layers",S="/api/layer",k="/api/layer/rename",E="/api/layer",N="/api/jobs",C="/api/logs",T="/api/log",M="/auth/user",L="/auth/token",R=n(16),P=n(38),F=n(230),A=n(46),D=n(60),B=n.n(D),I=B.a.create({});!function(){var e=localStorage.getItem("JWT");I.defaults.headers.common.Authorization=null===e?null:"Bearer ".concat(e)}();var z=I,H=n(43),Y=n(249),U=n(3),V=function(e){return Object(U.jsx)(Y.a,Object(H.a)({is:o.b},e))};function G(e){return Object(U.jsxs)(P.a,{className:"header",children:[Object(U.jsx)(V,{to:u,className:"headerLink ".concat(e.home?"selected":""),children:"Home"}),Object(U.jsx)(V,{to:j,className:"headerLink ".concat(e.projects?"selected":""),children:"Projects"}),Object(U.jsx)(V,{to:p,className:"headerLink ".concat(e.jobs?"selected":""),children:"Jobs & Logs"})]})}function J(){var e=Object(i.useState)([]),t=Object(R.a)(e,2),n=t[0],a=t[1],r=Object(l.g)();return Object(i.useEffect)((function(){return z.get(g).then((function(e){console.log(e.data),a(e.data)})),function(){a([])}}),[]),Object(U.jsxs)(P.a,{className:"home",children:[Object(U.jsx)(F.a,{className:"homeHeading",children:"Metacity"}),Object(U.jsx)(P.a,{className:"homeProjectList",children:n.map((function(e,t){return Object(U.jsx)(A.a,{height:48,onClick:function(){return r.push(f+e)},children:e},t)}))}),Object(U.jsx)(V,{to:j,className:"homeNav",children:"Go to Controls"})]})}var W=n(276),q=n(268),K=n(264),X=n(257),Q=n(258),Z=n(250),$=n(253),ee=n(254);function te(e){var t=Object(i.createRef)(),n=Object(i.useState)(""),a=Object(R.a)(n,2),r=a[0],c=a[1],s=function(n){var i;n&&n.preventDefault();var a=null===(i=t.current)||void 0===i?void 0:i.value;a&&z.post(O,{old:e.name,new:a}).then((function(){t.current&&(t.current.value=""),e.setIsShown(!1),e.onSubmit(a)})).catch((function(e){c("Project ".concat(a," already exists"))}))};return Object(i.useEffect)((function(){c("")}),[e.isShown]),Object(U.jsxs)(Z.a,{isShown:e.isShown,title:"Rename project ".concat(e.name),onConfirm:function(){return s()},onCloseComplete:function(){return e.setIsShown(!1)},confirmLabel:"Rename",children:[Object(U.jsx)("form",{className:"dialogForm",onSubmit:s,children:Object(U.jsx)($.a,{name:"name",placeholder:"New project name",ref:t})}),r.length>0?Object(U.jsx)(ee.a,{intent:"danger",marginTop:16,children:r}):""]})}var ne=n(40);function ie(e){return Object(U.jsx)(Z.a,{isShown:e.isShown,intent:"danger",title:"Delete project",onConfirm:function(){z.delete(_,{data:{name:e.name}}).then((function(){e.onSubmit(),e.setIsShown(!1)}))},onCloseComplete:function(){return e.setIsShown(!1)},confirmLabel:"Delete",children:Object(U.jsxs)(ne.a,{children:["Are you sure you want to delete project ",e.name,"?"]})})}var ae=n(273),re=n(233),ce=n(259);function se(e){var t=Object(i.createRef)(),n=Object(i.useState)(""),a=Object(R.a)(n,2),r=a[0],c=a[1];return Object(i.useEffect)((function(){c("")}),[e.isShown]),Object(U.jsxs)(Z.a,{isShown:e.isShown,title:"Rename layer ".concat(e.name),onConfirm:function(){return function(n){var i;n&&n.preventDefault();var a=null===(i=t.current)||void 0===i?void 0:i.value;a&&z.post(k,{project:e.project,old:e.name,new:a}).then((function(){t.current&&(t.current.value=""),e.setIsShown(!1),e.onSubmit(a)})).catch((function(){c("Layer ".concat(a," already exists"))}))}()},onCloseComplete:function(){return e.setIsShown(!1)},confirmLabel:"Rename",children:[Object(U.jsx)("form",{className:"dialogForm",children:Object(U.jsx)($.a,{name:"name",placeholder:"New layer name",ref:t})}),Object(U.jsx)("p",{children:r}),r.length>0?Object(U.jsx)(ee.a,{intent:"danger",marginTop:16,children:r}):""]})}function oe(e){return Object(U.jsx)(Z.a,{isShown:e.isShown,title:"Delete layer ".concat(e.name),onConfirm:function(){z.delete(E,{data:{project:e.project,name:e.name}}).then((function(){e.setIsShown(!1),e.onSubmit()}))},onCloseComplete:function(){return e.setIsShown(!1)},intent:"danger",confirmLabel:"Delete",children:Object(U.jsxs)(ne.a,{children:["Are you sure you want to delete layer ",e.name,"?"]})})}function le(e){var t=Object(i.useState)([]),n=Object(R.a)(t,2),a=n[0],r=n[1],c=Object(i.useState)(void 0),s=Object(R.a)(c,2),o=s[0],l=s[1],u=Object(i.useState)(!1),d=Object(R.a)(u,2),h=d[0],f=d[1],m=Object(i.useState)(!1),j=Object(R.a)(m,2),p=j[0],b=j[1],g=function(){z.post(w,{name:e.projectName}).then((function(e){console.log(e.data),r(e.data)}))};return Object(i.useEffect)((function(){return g(),function(){r([])}}),[e.projectName]),Object(U.jsxs)(P.a,{children:[h?Object(U.jsx)(se,{name:o,isShown:h,setIsShown:function(e){return f(e)},onSubmit:g,project:e.projectName}):"",p?Object(U.jsx)(oe,{name:o,isShown:p,setIsShown:function(e){return b(e)},onSubmit:g,project:e.projectName}):"",Object(U.jsxs)(ae.a,{children:[Object(U.jsxs)(ae.a.Head,{className:"row",children:[Object(U.jsx)(ae.a.TextHeaderCell,{className:"wide",children:"Layer"}),Object(U.jsx)(ae.a.TextHeaderCell,{className:"wide",children:"Number of Objects"}),Object(U.jsx)(ae.a.TextHeaderCell,{className:"narrow",children:"rename"}),Object(U.jsx)(ae.a.TextHeaderCell,{className:"narrow",children:"delete"})]}),Object(U.jsx)(ae.a.Body,{children:a.length>0?a.map((function(e){return Object(U.jsxs)(ae.a.Row,{paddingY:12,height:"auto",className:"row",children:[Object(U.jsx)(ae.a.TextCell,{className:"wide",children:e.name}),Object(U.jsx)(ae.a.TextCell,{className:"wide",children:e.size}),Object(U.jsx)(ae.a.TextCell,{className:"narrow",children:Object(U.jsx)(re.a,{icon:X.a,onClick:function(){l(e.name),f(!0)}})}),Object(U.jsx)(ae.a.TextCell,{className:"narrow",children:Object(U.jsx)(re.a,{icon:Q.a,intent:"danger",onClick:function(){l(e.name),b(!0)}})})]},e.name)})):Object(U.jsx)(W.a,{background:"light",title:"No Layers in this Project",orientation:"horizontal",icon:Object(U.jsx)(ce.a,{color:"#C1C4D6"}),iconBgColor:"#EDEFF5",description:"Layers apper after successfull processing of the input files.",anchorCta:Object(U.jsx)(W.a.LinkButton,{is:V,to:v+e.projectName,children:"Add first layer"})})})]})]})}var ue=n(260),de=n(274),he=n(261),fe=n(262),me=n(263);function je(e){return Object(U.jsx)(Z.a,{isShown:e.isShown,intent:"danger",title:"Recompile project",onConfirm:function(){z.post(y,{name:e.name}).then((function(t){e.setIsShown(!1),e.onSubmit()}))},onCloseComplete:function(){return e.setIsShown(!1)},confirmLabel:"Recompile",children:Object(U.jsxs)(ne.a,{children:["Are you sure you want to recompile project ",e.name,"?"]})})}function pe(e){var t=Object(l.g)(),n=Object(i.useState)(!1),a=Object(R.a)(n,2),r=a[0],c=a[1];return Object(U.jsxs)(P.a,{children:[Object(U.jsx)(je,{isShown:r,setIsShown:function(e){return c(e)},onSubmit:function(){t.push(p)},name:e.name}),Object(U.jsx)(A.a,{marginRight:12,height:48,iconBefore:ue.a,onClick:function(){return t.push(v+e.name)},children:"Add Layer"}),Object(U.jsx)(de.a,{content:"Recompile after updating layers or styles to view the changes in the visualization",children:Object(U.jsx)(A.a,{marginRight:12,height:48,iconBefore:he.a,onClick:function(){return c(!0)},children:"Recompile 3D"})}),Object(U.jsx)(A.a,{marginRight:12,height:48,iconBefore:fe.a,onClick:function(){},disabled:!0,children:"Add Styles"}),Object(U.jsx)(A.a,{marginRight:12,height:48,iconBefore:me.a,onClick:function(){},disabled:!0,children:"Map Layers"})]})}function be(e){var t=Object(i.useState)(!1),n=Object(R.a)(t,2),a=n[0],r=n[1],c=Object(i.useState)(!1),s=Object(R.a)(c,2),o=s[0],u=s[1],d=Object(l.g)();return Object(i.useEffect)((function(){return function(){r(!1),u(!1)}}),[]),Object(U.jsxs)(P.a,{className:"project",children:[Object(U.jsx)(te,{name:e.name,isShown:a,setIsShown:function(e){return r(e)},onSubmit:e.showProject}),Object(U.jsx)(ie,{name:e.name,isShown:o,setIsShown:function(e){return u(e)},onSubmit:function(){return e.showProject()}}),Object(U.jsxs)(P.a,{className:"projectHeader",children:[Object(U.jsxs)(F.a,{className:"wide",children:["Project ",e.name]}),Object(U.jsx)(A.a,{marginY:8,marginRight:12,iconBefore:K.a,onClick:function(){d.push(f+e.name)},children:"View"}),Object(U.jsx)(A.a,{marginY:8,marginRight:12,iconBefore:X.a,onClick:function(){return r(!0)},children:"Rename"}),Object(U.jsx)(A.a,{marginY:8,marginRight:12,iconBefore:Q.a,onClick:function(){return u(!0)},intent:"danger",children:"Delete..."})]}),Object(U.jsx)(le,{projectName:e.name}),Object(U.jsx)(F.a,{is:"h3",children:"Actions"}),Object(U.jsx)(pe,{name:e.name})]})}var ve,ge=n(265),xe=n(266),Oe=n(267);function _e(e){return Object(U.jsxs)(P.a,{className:"list",children:[Object(U.jsx)(F.a,{className:"projectList title",children:"Projects"}),Object(U.jsxs)(P.a,{className:"projectList action",onClick:e.onAddDialog,children:[Object(U.jsx)(ge.a,{}),"Add Project"]}),Object(U.jsx)(xe.a,{className:"projectList tabs",children:e.projects.map((function(t){return Object(U.jsx)(Oe.a,{id:"tab-".concat(t),onSelect:function(){return e.onSelect(t)},isSelected:t===e.currentProject,"aria-controls":"panel-".concat(t),children:t},t)}))})]})}function ye(e){var t=Object(i.createRef)(),n=Object(i.useState)(""),a=Object(R.a)(n,2),r=a[0],c=a[1],s=function(n){var i;n&&n.preventDefault();var a=null===(i=t.current)||void 0===i?void 0:i.value;a&&z.post(x,{name:a}).then((function(n){console.log(n.data),t.current&&(t.current.value=""),e.setIsShown(!1),e.onSubmit()})).catch((function(e){c("Project ".concat(a," already exists"))}))};return Object(i.useEffect)((function(){c("")}),[e.isShown]),Object(U.jsxs)(Z.a,{isShown:e.isShown,title:"Create new project",onConfirm:function(){return s()},onCloseComplete:function(){return e.setIsShown(!1)},confirmLabel:"Create",children:[Object(U.jsx)("form",{className:"dialogForm",onSubmit:s,children:Object(U.jsx)($.a,{name:"name",placeholder:"Project Name",ref:t})}),r.length>0?Object(U.jsx)(ee.a,{intent:"danger",marginTop:16,children:r}):""]})}function we(e,t){z.get(M).then((function(e){console.log("user auth",e.data),t()})).catch((function(t){e.push(d)}))}function Se(){var e=Object(i.useState)(""),t=Object(R.a)(e,2),n=t[0],a=t[1],r=Object(l.g)(),c=Object(i.createRef)(),s=Object(i.createRef)();return Object(i.useEffect)((function(){z.get(M).then((function(){r.push(j)})).catch((function(e){}))}),[]),Object(U.jsx)(P.a,{className:"fullScreen",children:Object(U.jsxs)(P.a,{children:[Object(U.jsx)(F.a,{is:"h1",children:"Login"}),n.length>0?Object(U.jsx)("p",{children:n}):"",Object(U.jsxs)("form",{onSubmit:function(e){var t,n,i,o;e.preventDefault(),console.log(null===(t=c.current)||void 0===t?void 0:t.value,null===(n=s.current)||void 0===n?void 0:n.value);var l=new FormData;l.append("username",(null===(i=c.current)||void 0===i?void 0:i.value)||""),l.append("password",(null===(o=s.current)||void 0===o?void 0:o.value)||""),z.post(L,l,{headers:{"Content-Type":"multipart/form-data"}}).then((function(e){console.log(e),localStorage.setItem("JWT",e.data.access_token),z.defaults.headers.common.Authorization="Bearer ".concat(e.data.access_token),r.push(j)})).catch((function(e){console.error(e),a("There was a problem with your login, check your username and password.")}))},children:[Object(U.jsx)($.a,{width:"100%",placeholder:"username",ref:c,type:"text"}),Object(U.jsx)($.a,{width:"100%",placeholder:"password",ref:s,type:"password"}),Object(U.jsx)($.a,{type:"submit"})]})]})})}function ke(){var e=Object(l.h)().project_name,t=Object(i.useState)(e),n=Object(R.a)(t,2),a=n[0],r=n[1],c=Object(i.useState)([]),s=Object(R.a)(c,2),o=s[0],u=s[1],d=Object(i.useState)(!1),h=Object(R.a)(d,2),f=h[0],m=h[1],p=Object(l.g)(),b=function(){z.get(g).then((function(e){console.log(e.data),u(e.data)}))};Object(i.useEffect)((function(){return we(p,(function(){b()})),function(){u([])}}),[]);var v=function(e){b(),r(e);var t=j;e&&(t+=e),p.push(t)};return Object(U.jsxs)(P.a,{children:[Object(U.jsx)(ye,{isShown:f,setIsShown:function(e){return m(e)},onSubmit:b}),Object(U.jsx)(G,{projects:!0}),Object(U.jsxs)(P.a,{className:"projects",children:[Object(U.jsx)(_e,{currentProject:a,onSelect:v,onAddDialog:function(){return m(!0)},projects:o}),Object(U.jsx)(P.a,{className:"content ".concat(a?"":"empty"),justifyContent:"center",alignItems:"center",children:a?Object(U.jsx)(be,{name:a,showProject:v}):Object(U.jsx)(W.a,{background:"light",title:"No project selected",orientation:"vertical",icon:Object(U.jsx)(q.a,{color:"#C1C4D6"}),iconBgColor:"#EDEFF5"})})]})]})}!function(e){e[e.empty=0]="empty",e[e.exists=1]="exists",e[e.valid=2]="valid"}(ve||(ve={}));var Ee=n(231),Ne=n(49),Ce=n(119),Te=n(56);function Me(e){var t=Object(Ce.a)(),n=t.acceptedFiles,a=t.getRootProps,r=t.getInputProps,c=Object(i.createRef)(),s=n.map((function(e){return Object(U.jsxs)("li",{children:[Object(U.jsx)("span",{className:"fileName",children:e.name}),Object(U.jsxs)("span",{className:"fileSize",children:[e.size," bytes"]})]},e.name)}));return Object(U.jsxs)(P.a,{className:"dropzoneContainer",children:[Object(U.jsxs)("form",{onSubmit:function(t){t.preventDefault(),e.submit(c.current.value,n)},id:"layerUploadForm",children:[Object(U.jsx)($.a,{placeholder:"layer name",ref:c,className:"layerName"}),Object(U.jsxs)("div",Object(H.a)(Object(H.a)({},a({className:"dropzone"})),{},{children:[Object(U.jsx)("input",Object(H.a)({},r())),Object(U.jsx)("p",{children:"Click or drag 'n' drop layer files here"}),Object(U.jsx)("ul",{className:"filelist",children:s})]}))]}),Object(U.jsx)(A.a,{marginRight:16,appearance:"primary",type:"submit",form:"layerUploadForm",children:"Upload"})]})}function Le(){var e=Object(l.h)().project_name,t=Object(l.g)(),n=Object(i.useState)(0),a=Object(R.a)(n,2),r=a[0],c=a[1],s=Object(i.useState)(!1),o=Object(R.a)(s,2),u=o[0],d=o[1];Object(i.useEffect)((function(){we(t,(function(){}))}),[]);return Object(U.jsxs)(P.a,{children:[Object(U.jsx)(G,{projects:!0}),Object(U.jsxs)(P.a,{className:"upload",children:[u?Object(U.jsx)(Ee.a,{}):Object(U.jsx)(Ne.a,{icon:ce.a,size:30,color:"#C1C4D6",background:"#EDEFF5",className:"uploadIcon",padding:20,borderRadius:40}),Object(U.jsxs)(F.a,{className:"uploadTitle",children:["Uploading Layer to Project ",e]}),u?Object(U.jsx)(P.a,{className:"progress",children:Object(U.jsxs)(ne.a,{className:"label",children:[r.toFixed(0),"%"]})}):Object(U.jsx)(Me,{submit:function(n,i){if(!u)if(void 0!==n&&0!=n.length)if(void 0!==i&&0!=i.length){d(!0);var a=new FormData;a.append("project",e),a.append("layer",n),i.forEach((function(e){a.append("files",e)})),z.post(S,a,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(e){return c(e.loaded/e.total*100)}}).then((function(e){console.log(e),t.push(p)}))}else Object(Te.b)("No files provided");else Object(Te.b)("No name specified")}})]})]})}var Re=n(279),Pe=n(269),Fe=n(270),Ae=n(271),De=n(117),Be=n.n(De);function Ie(){var e,t=Object(i.useState)([]),n=Object(R.a)(t,2),a=n[0],r=n[1],c=Object(i.useState)(void 0),s=Object(R.a)(c,2),o=s[0],l=s[1],u=Object(i.useState)(!1),d=Object(R.a)(u,2),h=d[0],f=d[1],m=function t(){z.get(N).then((function(n){console.log(n.data),r(n.data),e=setTimeout(t,2e3)}))};return Object(i.useEffect)((function(){return m(),function(){clearTimeout(e),r([])}}),[]),Object(U.jsxs)(P.a,{children:[Object(U.jsx)(Re.a,{isShown:h,onCloseComplete:function(){return f(!1)},preventBodyScrolling:!0,children:Object(U.jsxs)(P.a,{className:"jsonRaw",children:[Object(U.jsxs)(F.a,{className:"jsonHeading",children:["Job ",null===o||void 0===o?void 0:o.job_id]}),Object(U.jsx)(P.a,{className:"json",children:Object(U.jsx)(Be.a,{src:o,enableClipboard:!1,theme:{base00:"#FFF",base01:"#DDD",base02:"#DDD",base03:"#444",base04:"#BBB",base05:"#444",base06:"#444",base07:"#444",base08:"#444",base09:"#3366FF",base0A:"#3366FF",base0B:"#3366FF",base0C:"#3366FF",base0D:"#BBB",base0E:"#BBB",base0F:"#3366FF"}})})]})}),Object(U.jsxs)(ae.a,{children:[Object(U.jsxs)(ae.a.Head,{className:"row",children:[Object(U.jsx)(ae.a.TextHeaderCell,{className:"wide",children:"Job Type"}),Object(U.jsx)(ae.a.TextHeaderCell,{className:"wide",children:"Status"}),Object(U.jsx)(ae.a.TextHeaderCell,{className:"wide",children:"Project"}),Object(U.jsx)(ae.a.TextHeaderCell,{className:"narrow",children:"Log"}),Object(U.jsx)(ae.a.TextHeaderCell,{className:"narrow",children:"Raw"})]}),Object(U.jsx)(ae.a.Body,{children:a.length>0?a.map((function(e){return Object(U.jsxs)(ae.a.Row,{paddingY:12,height:"auto",className:"row",children:[Object(U.jsx)(ae.a.TextCell,{className:"wide",children:e.type}),Object(U.jsx)(ae.a.TextCell,{className:"wide",children:e.status}),Object(U.jsx)(ae.a.TextCell,{className:"wide",children:e.project?e.project:"--"}),Object(U.jsx)(ae.a.TextCell,{className:"narrow",children:Object(U.jsx)(re.a,{icon:Pe.a,onClick:function(){},disabled:!0})}),Object(U.jsx)(ae.a.TextCell,{className:"narrow",children:Object(U.jsx)(re.a,{icon:Fe.a,onClick:function(){l(e),f(!0)}})})]},e.job_id)})):Object(U.jsx)(W.a,{background:"light",title:"No Running Jobs",orientation:"horizontal",icon:Object(U.jsx)(Ae.a,{color:"#C1C4D6"}),iconBgColor:"#EDEFF5",description:"Jobs run in the background and process input data into visualizable elements"})})]})]})}var ze=n(272);function He(e){var t,n=Object(i.useState)(""),a=Object(R.a)(n,2),r=a[0],c=a[1],s=function n(){z.post(T,{name:e.name}).then((function(e){c(e.data),t=setTimeout(n,2e3)}))};return Object(i.useEffect)((function(){return s(),function(){c(""),clearTimeout(t)}}),[e.name]),Object(U.jsx)(P.a,{className:"logContents",children:r&&r.length>0?Object(U.jsx)(ze.a,{className:"logLines",children:r.split(/[\r\n]+/).map((function(e,t){return Object(U.jsx)("span",{children:e},t)}))}):Object(U.jsx)(ze.a,{children:"No contents"})})}function Ye(){var e,t=Object(i.useState)([]),n=Object(R.a)(t,2),a=n[0],r=n[1],c=Object(i.useState)(void 0),s=Object(R.a)(c,2),o=s[0],l=s[1],u=function t(){z.get(C).then((function(n){console.log(n.data),r(n.data),e=setTimeout(t,2e3)}))};return Object(i.useEffect)((function(){return u(),function(){r([]),clearTimeout(e)}}),[]),Object(U.jsxs)(P.a,{children:[Object(U.jsx)(xe.a,{className:"logList",marginBottom:16,flexBasis:240,marginRight:24,children:a.map((function(e,t){return Object(U.jsx)(Oe.a,{id:e,onSelect:function(){return l(e)},isSelected:e===o,"aria-controls":"panel-".concat(e),className:"logTab",children:e},e)}))}),Object(U.jsx)(P.a,{children:o?Object(U.jsx)(He,{name:o}):Object(U.jsx)(W.a,{background:"light",title:"No Log selected",orientation:"horizontal",icon:Object(U.jsx)(Pe.a,{color:"#C1C4D6"}),iconBgColor:"#EDEFF5",description:"Logs contain debug information for running processes"})})]})}function Ue(){var e=Object(l.g)();return Object(i.useEffect)((function(){we(e,(function(){}))}),[]),Object(U.jsxs)(P.a,{children:[Object(U.jsx)(G,{jobs:!0}),Object(U.jsxs)(P.a,{className:"jobs",children:[Object(U.jsx)(F.a,{className:"jobsHeading",children:"Jobs"}),Object(U.jsx)(Ie,{})]}),Object(U.jsxs)(P.a,{className:"logs",children:[Object(U.jsx)(F.a,{className:"logsHeading",children:"Logs"}),Object(U.jsx)(Ye,{})]})]})}var Ve=n(34),Ge=n(2),Je=n(4),We=n(8),qe=n(5),Ke=n(6),Xe=n(83),Qe=n(85),Ze=n(20),$e=function(){function e(){Object(Ge.a)(this,e)}return Object(Je.a)(e,null,[{key:"base64tofloat32",value:function(e,t,n){var i=window.atob(e),a=i.length/Float64Array.BYTES_PER_ELEMENT,r=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT)),c=new Float32Array(a),s=0,o=1,l=a*Float64Array.BYTES_PER_ELEMENT;console.log(l);!function e(){for(var a=1e4*o*Float64Array.BYTES_PER_ELEMENT;s<Math.min(a,l);s+=Float64Array.BYTES_PER_ELEMENT){for(var u=0;u<Float64Array.BYTES_PER_ELEMENT;++u)r.setUint8(u,i.charCodeAt(s+u));c[s/Float64Array.BYTES_PER_ELEMENT]=r.getFloat64(0,!0)}t.removed||(s<l?(o++,setTimeout(e,10)):(r=null,i=null,n(c)))}()}},{key:"base64toint32",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,a=window.atob(e),r=a.length/Int32Array.BYTES_PER_ELEMENT,c=new DataView(new ArrayBuffer(Int32Array.BYTES_PER_ELEMENT)),s=new Uint32Array(r*Int32Array.BYTES_PER_ELEMENT),o=0,l=1,u=1e4,d=r*Int32Array.BYTES_PER_ELEMENT,h=function e(){for(var r=l*u*Int32Array.BYTES_PER_ELEMENT;o<Math.min(r,d);o+=Int32Array.BYTES_PER_ELEMENT){for(var h=0;h<Int32Array.BYTES_PER_ELEMENT;++h)c.setUint8(h,a.charCodeAt(o+h));s[o/Int32Array.BYTES_PER_ELEMENT]=c.getUint32(0,!0)+t}n.removed||(o<d?(l++,setTimeout(e,10)):(c=null,a=null,i(new Uint8Array(s.buffer))))};h()}}]),e}();function et(e){for(var t=[],n=Math.PI/2,i=Math.PI/e,a=0;a<e;++a)t.push(0,0,0),t.push(Math.cos(n+i*a),Math.sin(n+i*a),0),t.push(Math.cos(n+i*(a+1)),Math.sin(n+i*(a+1)),0);return t}function tt(e){for(var t=[],n=Math.PI/2,i=Math.PI/e,a=0;a<e;++a)t.push(1,0,0),t.push(1-Math.cos(n+i*a),Math.sin(n+i*a),0),t.push(1-Math.cos(n+i*(a+1)),Math.sin(n+i*(a+1)),0);return t}function nt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[0,-1,0,1,-1,0,1,1,0,0,-1,0,1,1,0,0,1,0];return t=(t=t.concat(et(e))).concat(tt(e))}var it=function(){function e(t){Object(Ge.a)(this,e),this.renderer=void 0,this.mesh=void 0,this.pickingMesh=void 0,this.removed=void 0,this.renderer=t,this.removed=!1}return Object(Je.a)(e,[{key:"remove",value:function(){this.mesh=this.removeFrom(this.mesh,this.renderer.scene),this.pickingMesh=this.removeFrom(this.pickingMesh,this.renderer.pickingScene),this.removed=!0}},{key:"removeFrom",value:function(e,t){e&&(t.remove(e),e.geometry.dispose())}}]),e}(),at=function(e){Object(qe.a)(n,e);var t=Object(Ke.a)(n);function n(e,i,a){var r,c=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];Object(Ge.a)(this,n),r=t.call(this,i);var s=i.picker.offsetForLayer(a.name);return $e.base64tofloat32(e.vertices,Object(Ze.a)(r),(function(t){if(!r.removed)if(c)$e.base64toint32(e.attributes.oid.data,s,Object(Ze.a)(r),(function(e){if(!r.removed){var n=r.createGeometry(t,e);r.createMesh(n,c),r.createPickingMesh(n),r.renderer.changed=!0,r.removed&&r.remove()}}));else{var n=r.createGeometry(t);r.createMesh(n,c),r.renderer.changed=!0,r.removed&&r.remove()}})),r}return Object(Je.a)(n,[{key:"createPickingMesh",value:function(e){var t=new We.o(e,this.renderer.matlib.pickingMaterial);this.renderer.pickingScene.add(t),this.pickingMesh=t}},{key:"createMesh",value:function(e,t){var n=t?this.renderer.matlib.polygonSelectMaterial:this.renderer.matlib.polygonMaterial,i=new We.o(e,n);i.receiveShadow=!0,i.castShadow=!0,this.renderer.scene.add(i),this.mesh=i}},{key:"createGeometry",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=new We.d;return n.setAttribute("position",new We.c(e,3)),t&&n.setAttribute("objectID",new We.c(t,4,!0)),n.computeVertexNormals(),n}}]),n}(it),rt=function(e){Object(qe.a)(n,e);var t=Object(Ke.a)(n);function n(e,i,a){var r;Object(Ge.a)(this,n),r=t.call(this,i);var c=i.picker.offsetForLayer(a.name);return $e.base64tofloat32(e.vertices,Object(Ze.a)(r),(function(t){r.removed||$e.base64toint32(e.attributes.oid.data,c,Object(Ze.a)(r),(function(e){if(!r.removed){var n=r.createGeometry(t);r.createMesh(n),r.renderer.changed=!0,r.removed&&r.remove()}}))})),r}return Object(Je.a)(n,[{key:"createMesh",value:function(e){var t=new We.o(e,this.renderer.matlib.lineMaterial);t.frustumCulled=!1,this.renderer.scene.add(t),this.mesh=t}},{key:"createGeometry",value:function(e){var t=new We.i;return t.instanceCount=e.length/3,t.setAttribute("position",new We.c(new Float32Array(nt()),3)),t.setAttribute("lineStart",new We.k(new We.j(e,6,1),3,0)),t.setAttribute("lineEnd",new We.k(new We.j(e,6,1),3,3)),t}}]),n}(it),ct=function(e){Object(qe.a)(n,e);var t=Object(Ke.a)(n);function n(e,i,a){var r;Object(Ge.a)(this,n),r=t.call(this,i);var c=i.picker.offsetForLayer(a.source);return $e.base64tofloat32(e.vertices,Object(Ze.a)(r),(function(t){r.removed||$e.base64toint32(e.attributes.oid.data,c,Object(Ze.a)(r),(function(e){if(!r.removed){var n=r.createGeometry(t);r.createMesh(n),r.renderer.changed=!0,r.removed&&r.remove()}}))})),r}return Object(Je.a)(n,[{key:"createMesh",value:function(e){var t=new We.o(e,this.renderer.matlib.lineMaterial);t.frustumCulled=!1,this.renderer.scene.add(t),this.mesh=t}},{key:"createGeometry",value:function(e){var t=new We.i;return t.instanceCount=e.length/3,t.setAttribute("position",new We.c(new Float32Array(nt()),3)),t.setAttribute("lineStart",new We.k(new We.j(e,6,1),3,0)),t.setAttribute("lineEnd",new We.k(new We.j(e,6,1),3,3)),t}}]),n}(it),st=function(){function e(t,n,i){Object(Ge.a)(this,e),this.bbox=void 0,this.brect=void 0,this.x=void 0,this.y=void 0,this.renderer=void 0,this.layer=void 0,this.sourceFile=void 0,this.stopFlag=void 0,this.isVisible=void 0,this.models=void 0,this.bbox=[Object(Xe.a)(We.B,Object(Qe.a)(t.box[0])),Object(Xe.a)(We.B,Object(Qe.a)(t.box[1]))],this.brect=[new We.A(this.bbox[0].x,this.bbox[0].y),new We.A(this.bbox[1].x,this.bbox[1].y)],this.x=t.x,this.y=t.y,this.sourceFile=t.file,this.layer=i,this.renderer=n,this.isVisible=!1,this.models=[]}return Object(Je.a)(e,[{key:"visible",set:function(e){this.isVisible!==e&&(this.isVisible=e,e?this.forRender():this.stopRender())}},{key:"forRender",value:function(){var e=this;this.stopFlag=B.a.CancelToken.source(),z.get("/api/data/".concat(this.layer.project,"/").concat(this.layer.name,"/grid/tiles/").concat(this.sourceFile),{cancelToken:this.stopFlag.token}).then((function(t){e.createModels(t.data),e.postRenderCheck()})).catch((function(e){console.log(e)}))}},{key:"createModels",value:function(e){var t,n=Object(Ve.a)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value,a=this.deserializeModel(i);a&&this.models.push(a)}}catch(r){n.e(r)}finally{n.f()}}},{key:"deserializeModel",value:function(e){if(e.tags&&!0===e.tags.proxy){if("simpleline"===e.type)return new ct(e,this.renderer,this.layer)}else{if("simplepolygon"===e.type)return new at(e,this.renderer,this.layer);if("simpleline"===e.type)return new rt(e,this.renderer,this.layer)}}},{key:"postRenderCheck",value:function(){this.isVisible||this.stopRender()}},{key:"stopRender",value:function(){if(this.models.length>0){var e,t=Object(Ve.a)(this.models);try{for(t.s();!(e=t.n()).done;){e.value.remove()}}catch(n){t.e(n)}finally{t.f()}this.models=[]}this.stopFlag&&(this.stopFlag.cancel(),this.stopFlag=null)}}]),e}();function ot(e,t){var n=Math.max(Math.abs(e),Math.abs(t));if(0===e&&0===t)return 0;var i,a=8*((i=n-1)*(i+1)/2);if(e>Math.abs(t)||e===t&&e>0)return a+n+t;if((t>Math.abs(e)||t===-e)&&t>0)return a+4*n-n-e;if(e<t||e===t&&e<0)return a+5*n-t;if(t<e||-t===e&&t<0)return a+7*n+e;throw"Cannot covert to 1D"}var lt=function(){function e(t,n,i){var a;Object(Ge.a)(this,e),this.bbox=void 0,this.brect=void 0,this.focusPoint=void 0,this.renderer=void 0,this.tileSize=void 0,this.tiles=void 0,this.visible_radius=void 0,this.visible=void 0,this.visibleSwap=void 0,this.zero2=void 0,this.layer=void 0,this.tileSize=t.tile_size,this.renderer=n,this.layer=i,this.bbox=[new We.B(1/0,1/0,1/0),new We.B(-1/0,-1/0,-1/0)],this.tiles=new Map,this.createTiles(t,n,i),this.brect=[new We.A(this.bbox[0].x,this.bbox[0].y),new We.A(this.bbox[1].x,this.bbox[1].y)],this.focusPoint=(a=this.bbox,new We.A(.5*(a[0].x+a[1].x),.5*(a[0].y+a[1].y))),this.visible_radius=2e3,this.visibleSwap=new Set,this.visible=new Set,this.zero2=new We.A}return Object(Je.a)(e,[{key:"createTiles",value:function(e,t,n){var i,a,r,c=Object(Ve.a)(e.tiles);try{for(c.s();!(i=c.n()).done;){var s=i.value,o=ot(s.x,s.y),l=new st(s,t,n);a=this.bbox,r=l.bbox,a[0].min(r[0]),a[1].max(r[1]),this.tiles.set(o,l)}}catch(u){c.e(u)}finally{c.f()}}},{key:"focus",value:function(e){var t=this.focusPoint.clone().divideScalar(this.tileSize).floor(),n=e.clone().sub(this.brect[0]).divideScalar(this.tileSize).floor();t.equals(n)||(this.focusPoint=e,this.update_visibility())}},{key:"update_visibility",value:function(){var e=this,t=this.visible;this.visible=this.visibleSwap,this.visibleSwap=t;var n=this.focusPoint.clone().divideScalar(this.tileSize).floor(),i=Math.ceil(this.visible_radius/this.tileSize),a=n.clone().subScalar(i),r=n.clone().addScalar(i+1);this.visible.clear();for(var c=a.x;c<r.x;++c)for(var s=a.y;s<r.y;++s){var o=ot(c,s),l=this.tiles.get(o);l&&(l.visible=!0,this.visible.add(l))}this.visibleSwap.forEach((function(t){e.visible.has(t)||(t.visible=!1)}))}}]),e}(),ut=function(){function e(t,n,i){Object(Ge.a)(this,e),this.name=void 0,this.project=void 0,this.renderer=void 0,this.grid=void 0,this.name=i.name,this.project=n,this.renderer=t,this.renderer.style.layer(this.name).visible&&(this.grid=new lt(i.layout,t,this))}return Object(Je.a)(e,[{key:"focus",value:function(e){this.grid&&this.grid.focus(e)}}]),e}(),dt=function(e){Object(qe.a)(n,e);var t=Object(Ke.a)(n);function n(e,i,a){var r;return Object(Ge.a)(this,n),(r=t.call(this,e,i,a)).size=void 0,r.size=a.size,r.renderer.picker.registerLayer(r.name,r.size),r.grid&&r.renderer.focus(r.grid.focusPoint),r}return n}(ut),ht=function(e){Object(qe.a)(n,e);var t=Object(Ke.a)(n);function n(e,i,a){var r;return Object(Ge.a)(this,n),(r=t.call(this,e,i,a)).source=void 0,r.target=void 0,r.source=a.source,r.target=a.target,r.grid&&r.renderer.focus(r.grid.focusPoint),r}return n}(ut),ft=n(121),mt=n(84),jt=function(e){Object(qe.a)(n,e);var t=Object(Ke.a)(n);function n(e,i){var a;return Object(Ge.a)(this,n),e.up=new We.B(0,0,1),(a=t.call(this,e,i)).screenSpacePanning=!1,a.mouseButtons.LEFT=We.l.PAN,a.mouseButtons.RIGHT=We.l.ROTATE,a.touches.ONE=We.y.PAN,a.touches.TWO=We.y.DOLLY_ROTATE,a.zoomSpeed=.5,a.dampingFactor=.1,a.enableDamping=!0,a.minDistance=5,a.minPolarAngle=.001,a.update(),a}return n}(n(118).a),pt=function(){function e(t){Object(Ge.a)(this,e),this.pickingTexture=void 0,this.pixelBuffer=void 0,this.renderer=void 0,this.selected=void 0,this.id=void 0,this.offsets=void 0,this.maxOffest=void 0,this.pickingTexture=new We.C(1,1),this.pixelBuffer=new Uint8Array(4),this.renderer=t,this.selected=[-1,-1,-1,-1],this.id=-1,this.offsets=new Map,this.maxOffest=0}return Object(Je.a)(e,[{key:"registerLayer",value:function(e,t){this.offsets.has(e)&&console.error("Registering layer ".concat(e," twice.")),this.offsets.set(e,[this.maxOffest,this.maxOffest+t]),this.maxOffest+=t}},{key:"offsetForLayer",value:function(e){this.offsets.has(e)||console.error("Layer ".concat(e," was not registered into the picker."));var t=this.offsets.get(e);return t?t[0]:0}},{key:"layerAndOidForId",value:function(e){var t,n=Object(Ve.a)(this.offsets.entries());try{for(n.s();!(t=n.n()).done;){var i=Object(R.a)(t.value,2),a=i[0],r=i[1];if(e>=r[0]&&e<r[1])return{layer:a,oid:e-r[0]}}}catch(c){n.e(c)}finally{n.f()}}},{key:"pick",value:function(e,t,n,i){var a=this.pickingTexture,r=this.pixelBuffer,c=this.renderer.getPixelRatio();return i.setViewOffset(this.renderer.getContext().drawingBufferWidth,this.renderer.getContext().drawingBufferHeight,e*c|0,t*c|0,1,1),this.renderer.setRenderTarget(a),this.renderer.render(n,i),this.renderer.setRenderTarget(null),i.clearViewOffset(),this.renderer.readRenderTargetPixels(a,0,0,1,1,r),this.selected=[r[0]/255,r[1]/255,r[2]/255,r[3]/255],this.id=new DataView(r.buffer).getUint32(0,!0),this.id}}]),e}();var bt=function e(t){Object(Ge.a)(this,e),this.polygonMaterial=void 0,this.polygonSelectMaterial=void 0,this.lineMaterial=void 0,this.pickingMaterial=void 0,this.polygonMaterial=new We.p({side:We.f}),t.setupMaterial(this.polygonMaterial),this.polygonSelectMaterial=function(){var e=We.z.merge([We.v.phong.uniforms,{selectedID:{value:[-1,-1,-1,-1]}}]);return new We.w({uniforms:e,vertexShader:"\n#define PHONG\n\nvarying vec3 vViewPosition;\n\nuniform vec4 selectedID;\n\nattribute vec4 objectID;\nvarying float varyingObjectID;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n    int marked = 1;\n\n    for(int i = 0; i < 4; ++i)\n        marked *= int(floor(selectedID[i] * 255.0 + 0.5) == floor(objectID[i] * 255.0 + 0.5));\n\n    varyingObjectID = float(marked);\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",fragmentShader:"\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\nvarying float varyingObjectID;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n    vec3 marked = vec3(0.5 * float(varyingObjectID > 0.5));\n\n\tvec4 diffuseColor = vec4( diffuse + marked, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",lights:!0,side:We.f,name:"custom-polygon-material"})}(),t.setupMaterial(this.polygonSelectMaterial),this.lineMaterial=function(){var e=We.z.merge([{zoffset:{value:1}}]);return new We.w({uniforms:e,vertexShader:"\n#define PHONG\n\nvarying vec3 vViewPosition;\n\nattribute vec3 lineStart;\nattribute vec3 lineEnd;\nuniform float zoffset;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n/**\n * Create rotation matrix from field vector.\n * The returned matrix can rotate vector (1, 0, 0)\n * into the desired setup.\n */\nmat4 getRotationMat(vec3 vector)\n{\n\tvec3 unit = vec3(1, 0, 0);\n\tvec3 f = normalize(vector);\n\tvec3 cross = cross(f, unit);\n\tvec3 a = normalize(cross);\n\tfloat s = length(cross);\n\tfloat c = dot(f, unit);\n\tfloat oc = 1.0 - c;\n\treturn mat4(oc * a.x * a.x + c,        oc * a.x * a.y - a.z * s,  oc * a.z * a.x + a.y * s,  0.0,\n                oc * a.x * a.y + a.z * s,  oc * a.y * a.y + c,        oc * a.y * a.z - a.x * s,  0.0,\n                oc * a.z * a.x - a.y * s,  oc * a.y * a.z + a.x * s,  oc * a.z * a.z + c,        0.0,\n                0.0,                       0.0,                       0.0,                       1.0);\n\n}\n\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex>\n\n\tvec3 dir = lineEnd - lineStart;\n    float dist = length(dir);\n    mat4 rot = getRotationMat(dir);\n\n\tconst float thickness = 1.0;\n\tfloat end = float(transformed.x >= 0.9);\n\ttransformed.x = end * (dist - 1.0 + transformed.x) + (1.0 - end) * transformed.x; //subtract one because its the original length of the template line\n\ttransformed.y *= thickness;\n\n    transformed = lineStart + (rot * vec4(transformed, 1.0)).xyz;\n\ttransformed.z += zoffset;\n\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",fragmentShader:"\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t//#include <lights_phong_fragment>\n\t//#include <lights_fragment_begin>\n\t//#include <lights_fragment_maps>\n\t//#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",side:We.f,name:"custom-line-material"})}(),this.pickingMaterial=function(){var e=We.z.merge([]);return new We.w({uniforms:e,vertexShader:"\nattribute vec4 objectID;\nvarying vec4 objectIDColor;\n\nvoid main() {\n    objectIDColor = objectID;\n    gl_Position = projectionMatrix * (modelViewMatrix * vec4( position, 1.0 ));\n}\n",fragmentShader:"\nvarying vec4 objectIDColor;\n\nvoid main() {\n\tgl_FragColor = vec4(objectIDColor);\n}\n",side:We.f,name:"custom-picking-material"})}()},vt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(Ge.a)(this,e),this.visible=!0,this.apply(t)}return Object(Je.a)(e,[{key:"apply",value:function(e){for(var t in this)void 0!==e[t]&&(this[t]=e[t])}}]),e}(),gt=function(){function e(t){Object(Ge.a)(this,e),this.style=void 0,this.style=t}return Object(Je.a)(e,[{key:"layer",value:function(e){var t=this.style[e];return t?new vt(t):new vt}}]),e}(),xt=function(){function e(t){Object(Ge.a)(this,e),this.canvas=void 0,this.scene=void 0,this.pickingScene=void 0,this.renderer=void 0,this.camera=void 0,this.controls=void 0,this.csm=void 0,this.picker=void 0,this.style=void 0,this.matlib=void 0,this.stats1=void 0,this.stats2=void 0,this.changed=void 0,this.canvas=t,this.scene=new We.t,this.pickingScene=new We.t,this.camera=new We.r(75,window.innerWidth/window.innerHeight,.1,5e3),this.renderer=new We.D({canvas:this.canvas,antialias:!0}),this.setupRenderer(),this.controls=new jt(this.camera,this.canvas),this.setupLightsAndShadows(),this.matlib=new bt(this.csm),this.style=new gt({DOP_TSK_UlicUsPAKOM_l:{visible:!1}}),this.picker=new pt(this.renderer),this.changed=!0,this.stats1=Object(mt.a)(),this.stats1.showPanel(0),this.stats1.dom.style.cssText="position:absolute;top:0px;left:0px;",document.body.appendChild(this.stats1.dom),this.stats2=Object(mt.a)(),this.stats2.showPanel(1),this.stats2.dom.style.cssText="position:absolute;top:0px;left:80px;",document.body.appendChild(this.stats2.dom)}return Object(Je.a)(e,[{key:"setupLightsAndShadows",value:function(){this.scene.add(new We.h(14540253,5592405,.6)),this.scene.add(new We.a(16777215,.2)),this.csm=new ft.a({fade:!0,mode:"practical",cascades:4,near:1,far:5e3,shadowBias:-5e-4,shadowMapSize:2048,lightDirection:new We.B(-1,-1,-2).normalize(),camera:this.camera,parent:this.scene,margin:5e3,lightFar:2e4,lightNear:1,lightIntensity:.3})}},{key:"setupRenderer",value:function(){var e=this;this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.autoUpdate=!1,this.renderer.shadowMap.type=We.q,this.renderer.setClearColor(16777215),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setAnimationLoop((function(){return e.frame()}))}},{key:"frame",value:function(){this.controls.update(),this.changed&&(this.csm.update(),this.renderer.shadowMap.needsUpdate=!0,this.renderer.render(this.scene,this.camera)),this.stats1.update(),this.stats2.update(),this.changed=!1}},{key:"focus",value:function(e){this.controls.target=new We.B(e.x,e.y,0),this.camera.position.x=e.x,this.camera.position.y=e.y-20,this.camera.position.z=1e3}},{key:"click",value:function(e,t){var n=this.picker.pick(e,t,this.pickingScene,this.camera);console.log(n),console.log(this.picker.layerAndOidForId(n)),this.matlib.polygonSelectMaterial.uniforms.selectedID={value:this.picker.selected},this.matlib.polygonSelectMaterial.uniformsNeedUpdate=!0,this.changed=!0}},{key:"focus_point",get:function(){return this.controls.target}}]),e}(),Ot=function(){function e(t,n){Object(Ge.a)(this,e),this.project=void 0,this.canvas=void 0,this.renderer=void 0,this.layers=void 0,this.project=t,this.canvas=n,this.renderer=new xt(this.canvas),this.layers=[]}return Object(Je.a)(e,[{key:"init",value:function(){var e=this;z.get("api/data/".concat(this.project,"/layout.json")).then((function(t){var n,i=Object(Ve.a)(t.data);try{for(i.s();!(n=i.n()).done;){var a=n.value;a.init&&("layer"===a.type&&e.layers.push(new dt(e.renderer,e.project,a)),"overlay"===a.type&&e.layers.push(new ht(e.renderer,e.project,a)))}}catch(r){i.e(r)}finally{i.f()}})),this.renderer.controls.addEventListener("change",(function(){return e.moved()}))}},{key:"moved",value:function(){var e,t=this.renderer.focus_point,n=new We.A(t.x,t.y),i=Object(Ve.a)(this.layers);try{for(i.s();!(e=i.n()).done;){e.value.focus(n)}}catch(a){i.e(a)}finally{i.f()}this.renderer.changed=!0}},{key:"doubleclick",value:function(e,t){this.renderer.click(e,t)}},{key:"exit",value:function(){}}]),e}();function _t(){var e,t=Object(l.h)().project_name,n=Object(i.createRef)();return Object(i.useEffect)((function(){if(null!=n.current)return(e=new Ot(t,n.current)).init(),e.renderer.frame(),function(){e.exit(),window.location.reload()}}),[n,t]),Object(U.jsx)("div",{children:Object(U.jsx)("canvas",{ref:n,onDoubleClick:function(t){return e.doubleclick(t.clientX,t.clientY)},children:"Your browser does not support HTML5 canvas"})})}function yt(){return Object(U.jsxs)(o.a,{children:[Object(U.jsx)(Te.a,{position:"top-center",autoClose:1e4,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,pauseOnHover:!0}),Object(U.jsxs)(l.d,{children:[Object(U.jsx)(l.b,{exact:!0,path:["/"],children:Object(U.jsx)(l.a,{to:"/app"})}),Object(U.jsx)(l.b,{path:d,children:Object(U.jsx)(Se,{})}),Object(U.jsx)(l.b,{path:b,children:Object(U.jsx)(Le,{})}),Object(U.jsx)(l.b,{path:m,children:Object(U.jsx)(ke,{})}),Object(U.jsx)(l.b,{path:p,children:Object(U.jsx)(Ue,{})}),Object(U.jsx)(l.b,{path:h,children:Object(U.jsx)(_t,{})}),Object(U.jsx)(l.b,{path:u,children:Object(U.jsx)(J,{})})]})]})}c.a.render(Object(U.jsx)(a.a.StrictMode,{children:Object(U.jsx)(s.a.Provider,{value:{className:"react-icons"},children:Object(U.jsx)(yt,{})})}),document.getElementById("root"))}},[[228,1,2]]]);
//# sourceMappingURL=main.fd709ba5.chunk.js.map